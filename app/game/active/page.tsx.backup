'use client';

import React, { useState, useEffect } from 'react';
import { motion, AnimatePresence } from 'framer-motion';
import { useSearchParams } from 'next/navigation';

// ã‚«ãƒ¼ãƒ‰ã®å‹å®šç¾©
interface Card {
  suit: 'â™ ' | 'â™¥' | 'â™¦' | 'â™£';
  rank: string;
  value: number;
  color: 'red' | 'black';
}

// ãƒãƒ³ãƒ‰ã®å¼·ã•
interface HandRank {
  rank: number;
  name: string;
  cards: Card[];
}

// ã‚²ãƒ¼ãƒ è¨­å®š
interface GameSettings {
  tableId?: string;
  tournamentId?: string;
  gameType: 'cash' | 'tournament' | 'sit-and-go';
  blinds: { small: number; big: number };
  buyIn: number;
  maxPlayers: number;
  isPrivate: boolean;
  password?: string;
  isSpectating: boolean;
  tournamentSettings?: {
    levels: Array<{ level: number; blinds: { small: number; big: number }; duration: number }>;
    currentLevel: number;
    prizePool: number;
    playersRemaining: number;
    nextBreak: number;
  };
}

export default function PokerGame() {
  // URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®å–å¾—
  const searchParams = useSearchParams();
  const tableId = searchParams?.get('table');
  const tournamentId = searchParams?.get('tournament');
  const spectate = searchParams?.get('spectate') === 'true';
  const password = searchParams?.get('password');

  // ã‚²ãƒ¼ãƒ è¨­å®š
  const [gameSettings, setGameSettings] = useState<GameSettings>({
    tableId: tableId || undefined,
    tournamentId: tournamentId || undefined,
    gameType: tournamentId ? 'tournament' : 'cash',
    blinds: { small: 100, big: 200 },
    buyIn: 2000,
    maxPlayers: 9,
    isPrivate: false,
    password: password || undefined,
    isSpectating: spectate,
    tournamentSettings: tournamentId ? {
      levels: [
        { level: 1, blinds: { small: 25, big: 50 }, duration: 10 },
        { level: 2, blinds: { small: 50, big: 100 }, duration: 10 },
        { level: 3, blinds: { small: 100, big: 200 }, duration: 10 },
        { level: 4, blinds: { small: 200, big: 400 }, duration: 10 },
        { level: 5, blinds: { small: 300, big: 600 }, duration: 10 },
      ],
      currentLevel: 1,
      prizePool: 10000,
      playersRemaining: 45,
      nextBreak: 30,
    } : undefined,
  });

  // ã‚²ãƒ¼ãƒ çŠ¶æ…‹
  const [gamePhase, setGamePhase] = useState<'PREFLOP' | 'FLOP' | 'TURN' | 'RIVER' | 'SHOWDOWN'>('PREFLOP');
  const [currentTurn, setCurrentTurn] = useState(0); // ç¾åœ¨ã®ã‚¿ãƒ¼ãƒ³
  const [dealerSeat, setDealerSeat] = useState(0); // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼0ï¼ˆYouï¼‰ãŒãƒ‡ã‚£ãƒ¼ãƒ©ãƒ¼
  
  // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼0ã‚’åŸºæº–ã¨ã—ãŸæ™‚è¨ˆå›ã‚Šã®SBãƒ»BBè¨ˆç®—
  const getNextValidSeat = (startSeat: number, excludeSeats: number[] = [2, 3]) => {
    let nextSeat = (startSeat + 1) % 9;
    while (excludeSeats.includes(nextSeat)) {
      nextSeat = (nextSeat + 1) % 9;
    }
    return nextSeat;
  };
  
  const smallBlindSeat = getNextValidSeat(dealerSeat);
  const bigBlindSeat = getNextValidSeat(smallBlindSeat);
  
  // ã‚«ãƒ¼ãƒ‰ãƒ‡ãƒƒã‚­ã¨ã‚²ãƒ¼ãƒ ãƒ­ã‚¸ãƒƒã‚¯
  const [deck, setDeck] = useState<Card[]>([]);
  const [usedCards, setUsedCards] = useState<Card[]>([]);
  
  // ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼çŠ¶æ…‹
  const [playerStatuses, setPlayerStatuses] = useState([
    { id: 0, name: 'You', isOnline: true, stack: 2000, lastAction: '', isThinking: false },
    { id: 1, name: 'Player 2', isOnline: true, stack: 1200, lastAction: '', isThinking: false },
    { id: 2, name: 'Player 3', isOnline: true, stack: 1800, lastAction: '', isThinking: false },
    { id: 3, name: 'Player 4', isOnline: true, stack: 1600, lastAction: '', isThinking: false },
    { id: 4, name: 'Player 5', isOnline: true, stack: 1900, lastAction: '', isThinking: false },
    { id: 5, name: 'Player 6', isOnline: true, stack: 1500, lastAction: '', isThinking: false },
    { id: 6, name: 'Player 7', isOnline: true, stack: 1400, lastAction: '', isThinking: false },
    { id: 7, name: 'Player 8', isOnline: true, stack: 1300, lastAction: '', isThinking: false },
    { id: 8, name: 'Player 9', isOnline: true, stack: 1500, lastAction: '', isThinking: false },
  ]);

  // UIçŠ¶æ…‹
  const [showMenu, setShowMenu] = useState(false);
  const [showChat, setShowChat] = useState(false);
  const [animatingChips, setAnimatingChips] = useState(false);
  const [showWinner, setShowWinner] = useState(false);
  const [winner, setWinner] = useState('');
  const [chatMessage, setChatMessage] = useState('');
  const [chatMessages, setChatMessages] = useState([
    { user: 'ã‚·ã‚¹ãƒ†ãƒ ', text: 'ã‚²ãƒ¼ãƒ ãŒé–‹å§‹ã•ã‚Œã¾ã—ãŸ', time: new Date() }
  ]);
  
  // ãƒ¡ãƒ‹ãƒ¥ãƒ¼æ©Ÿèƒ½ã®çŠ¶æ…‹
  const [showHandHistory, setShowHandHistory] = useState(false);
  const [showWinnings, setShowWinnings] = useState(false);
  const [showShare, setShowShare] = useState(false);
  const [showRules, setShowRules] = useState(false);
  
  // ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒ†ãƒ¼ãƒ–ãƒ«èªè¨¼
  const [showPasswordModal, setShowPasswordModal] = useState(false);
  const [passwordInput, setPasswordInput] = useState('');
  const [isAuthenticated, setIsAuthenticated] = useState(true);
  const [authError, setAuthError] = useState('');
  const [showSettings, setShowSettings] = useState(false);
  const [soundEnabled, setSoundEnabled] = useState(true);
  const [autoPlayEnabled, setAutoPlayEnabled] = useState(false);
  const [showStats, setShowStats] = useState(false);
  const [gameStats, setGameStats] = useState({
    handsPlayed: 0,
    handsWon: 0,
    totalWinnings: 0,
    vpip: 0,
    pfr: 0
  });
  
  // ãƒãƒ³ãƒ‰å±¥æ­´
  const [handHistory, setHandHistory] = useState<Array<{
    gameId: number;
    date: Date;
    winner: string;
    pot: number;
    finalHand: string;
    boardCards: Card[];
  }>>([]);
  
  // ç²å¾—é‡‘é¡çµ±è¨ˆ
  const [winnings, setWinnings] = useState({
    totalWon: 0,
    totalLost: 0,
    netProfit: 0,
    handsPlayed: 0,
    handsWon: 0,
    winRate: 0
  });
  
  // ãƒ™ãƒƒãƒˆé¡
  const [raiseAmount, setRaiseAmount] = useState(400);
  const [showRaiseSlider, setShowRaiseSlider] = useState(false);
  const myStack = 2000; // Youã®ã‚¹ã‚¿ãƒƒã‚¯é¡

  // ãƒãƒƒãƒˆé¡
  const [pot, setPot] = useState(300); // SB(100) + BB(200)

  // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®æ‰‹æœ­ï¼ˆå‹•çš„ï¼‰
  const [playerHands, setPlayerHands] = useState<Card[][]>(Array(9).fill([]));
  
  // ã‚«ãƒ¼ãƒ‰ãƒ‡ãƒƒã‚­åˆæœŸåŒ–
  const createDeck = (): Card[] => {
    const suits: ('â™ ' | 'â™¥' | 'â™¦' | 'â™£')[] = ['â™ ', 'â™¥', 'â™¦', 'â™£'];
    const ranks = ['2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K', 'A'];
    const deck: Card[] = [];
    
    suits.forEach(suit => {
      ranks.forEach((rank, index) => {
        deck.push({
          suit,
          rank,
          value: index + 2,
          color: suit === 'â™¥' || suit === 'â™¦' ? 'red' : 'black'
        });
      });
    });
    
    return deck;
  };
  
  // ãƒ•ã‚£ãƒƒã‚·ãƒ£ãƒ¼ãƒ»ã‚¤ã‚§ãƒ¼ãƒ„ã‚·ãƒ£ãƒƒãƒ•ãƒ«ï¼ˆä¹±æ•°ç”Ÿæˆï¼‰
  const shuffleDeck = (deck: Card[]): Card[] => {
    const shuffled = [...deck];
    for (let i = shuffled.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
    }
    return shuffled;
  };
  
  // ãƒ‡ãƒƒã‚­ã‹ã‚‰ã‚«ãƒ¼ãƒ‰ã‚’1æšå¼•ã
  const drawCard = (): Card | null => {
    if (deck.length === 0) return null;
    const card = deck[0];
    setDeck(prev => prev.slice(1));
    setUsedCards(prev => [...prev, card]);
    return card;
  };
  
  // ã‚«ãƒ¼ãƒ‰æ¤œè¨¼ï¼ˆä¸æ­£é˜²æ­¢ï¼‰
  const validateCards = (): boolean => {
    const allCards = [...usedCards, ...playerHands.flat()];
    const cardStrings = allCards.map(card => `${card.suit}${card.rank}`);
    const uniqueCards = new Set(cardStrings);
    
    // é‡è¤‡ãƒã‚§ãƒƒã‚¯
    if (cardStrings.length !== uniqueCards.size) {
      console.error('âŒ Card duplication detected!');
      return false;
    }
    
    // ç·ã‚«ãƒ¼ãƒ‰æ•°ãƒã‚§ãƒƒã‚¯ï¼ˆ52æšä»¥å†…ï¼‰
    if (allCards.length > 52) {
      console.error('âŒ Too many cards in play!');
      return false;
    }
    
    // å„ã‚«ãƒ¼ãƒ‰ã®å¦¥å½“æ€§ãƒã‚§ãƒƒã‚¯
    for (const card of allCards) {
      if (!validateCard(card)) {
        console.error('âŒ Invalid card detected:', card);
        return false;
      }
    }
    
    console.log('âœ… Card validation passed');
    return true;
  };
  
  // å€‹åˆ¥ã‚«ãƒ¼ãƒ‰æ¤œè¨¼
  const validateCard = (card: Card): boolean => {
    const validSuits = ['â™ ', 'â™¥', 'â™¦', 'â™£'];
    const validRanks = ['2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K', 'A'];
    const validColors = ['red', 'black'];
    
    return (
      validSuits.includes(card.suit) &&
      validRanks.includes(card.rank) &&
      validColors.includes(card.color) &&
      card.value >= 2 && card.value <= 14 &&
      (card.suit === 'â™¥' || card.suit === 'â™¦') === (card.color === 'red')
    );
  };
  
  // ã‚²ãƒ¼ãƒ çŠ¶æ…‹ã®æ•´åˆæ€§ãƒã‚§ãƒƒã‚¯
  const validateGameState = (): boolean => {
    // ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æ•°ãƒã‚§ãƒƒã‚¯
    const activeCount = activePlayers.filter(Boolean).length;
    if (activeCount < 1) {
      console.error('âŒ No active players!');
      return false;
    }
    
    // ãƒ™ãƒƒãƒˆé¡ã®æ•´åˆæ€§ãƒã‚§ãƒƒã‚¯
    const totalBets = bets.reduce((sum, bet) => sum + bet.amount, 0);
    const expectedPot = 300 + totalBets; // SB + BB + ãƒ™ãƒƒãƒˆ
    if (Math.abs(pot - expectedPot) > 1) { // 1ãƒ‰ãƒ«ã®èª¤å·®ã¯è¨±å®¹
      console.error('âŒ Pot amount mismatch!');
      return false;
    }
    
    // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚¹ã‚¿ãƒƒã‚¯ã®æ•´åˆæ€§ãƒã‚§ãƒƒã‚¯
    for (let i = 0; i < playerStatuses.length; i++) {
      const player = playerStatuses[i];
      const bet = bets[i];
      if (player.stack < bet.amount) {
        console.error(`âŒ Player ${i} has insufficient stack!`);
        return false;
      }
    }
    
    console.log('âœ… Game state validation passed');
    return true;
  };
  
  // ãƒãƒ³ãƒ‰è©•ä¾¡ã‚·ã‚¹ãƒ†ãƒ 
  const evaluateHand = (playerCards: Card[], boardCards: Card[]): HandRank => {
    const allCards = [...playerCards, ...boardCards];
    if (allCards.length < 5) {
      return { rank: 0, name: 'Incomplete', cards: allCards };
    }
    
    // 5æšã®ã‚«ãƒ¼ãƒ‰ã§æœ€å¼·ã®ãƒãƒ³ãƒ‰ã‚’æ¢ã™
    const bestHand = getBestFiveCardHand(allCards);
    return rankHand(bestHand);
  };
  
  // 7æšã‹ã‚‰5æšã®æœ€å¼·ãƒãƒ³ãƒ‰ã‚’é¸æŠ
  const getBestFiveCardHand = (cards: Card[]): Card[] => {
    const combinations = getCombinations(cards, 5);
    let bestHand = combinations[0];
    let bestRank = rankHand(bestHand);
    
    for (const combo of combinations) {
      const rank = rankHand(combo);
      if (rank.rank > bestRank.rank || 
          (rank.rank === bestRank.rank && compareHands(rank, bestRank) > 0)) {
        bestHand = combo;
        bestRank = rank;
      }
    }
    
    return bestHand;
  };
  
  // çµ„ã¿åˆã‚ã›ç”Ÿæˆï¼ˆnCrï¼‰
  const getCombinations = (arr: Card[], r: number): Card[][] => {
    if (r === 1) return arr.map(card => [card]);
    if (r === arr.length) return [arr];
    
    const combinations: Card[][] = [];
    for (let i = 0; i <= arr.length - r; i++) {
      const head = arr[i];
      const tailCombos = getCombinations(arr.slice(i + 1), r - 1);
      for (const combo of tailCombos) {
        combinations.push([head, ...combo]);
      }
    }
    return combinations;
  };
  
  // ãƒãƒ³ãƒ‰ãƒ©ãƒ³ã‚¯åˆ¤å®š
  const rankHand = (cards: Card[]): HandRank => {
    const sorted = [...cards].sort((a, b) => b.value - a.value);
    const values = sorted.map(c => c.value);
    const suits = sorted.map(c => c.suit);
    
    // ãƒ•ãƒ©ãƒƒã‚·ãƒ¥åˆ¤å®š
    const isFlush = suits.every(suit => suit === suits[0]);
    
    // ã‚¹ãƒˆãƒ¬ãƒ¼ãƒˆåˆ¤å®š
    const isStraight = checkStraight(values);
    
    // ãƒšã‚¢ãƒ»ã‚¹ãƒªãƒ¼ãƒ»ãƒ•ã‚©ãƒ¼åˆ¤å®š
    const counts = getValueCounts(values);
    const pairs = Object.values(counts).filter(count => count === 2).length;
    const threeOfAKind = Object.values(counts).includes(3);
    const fourOfAKind = Object.values(counts).includes(4);
    
    // å½¹ã®åˆ¤å®š
    if (isFlush && isStraight) {
      if (values[0] === 14 && values[4] === 10) {
        return { rank: 9, name: 'ãƒ­ã‚¤ãƒ¤ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ãƒˆãƒ•ãƒ©ãƒƒã‚·ãƒ¥', cards: sorted };
      }
      return { rank: 8, name: 'ã‚¹ãƒˆãƒ¬ãƒ¼ãƒˆãƒ•ãƒ©ãƒƒã‚·ãƒ¥', cards: sorted };
    }
    
    if (fourOfAKind) {
      return { rank: 7, name: 'ãƒ•ã‚©ãƒ¼ã‚«ãƒ¼ãƒ‰', cards: sorted };
    }
    
    if (threeOfAKind && pairs >= 1) {
      return { rank: 6, name: 'ãƒ•ãƒ«ãƒã‚¦ã‚¹', cards: sorted };
    }
    
    if (isFlush) {
      return { rank: 5, name: 'ãƒ•ãƒ©ãƒƒã‚·ãƒ¥', cards: sorted };
    }
    
    if (isStraight) {
      return { rank: 4, name: 'ã‚¹ãƒˆãƒ¬ãƒ¼ãƒˆ', cards: sorted };
    }
    
    if (threeOfAKind) {
      return { rank: 3, name: 'ã‚¹ãƒªãƒ¼ã‚«ãƒ¼ãƒ‰', cards: sorted };
    }
    
    if (pairs === 2) {
      return { rank: 2, name: 'ãƒ„ãƒ¼ãƒšã‚¢', cards: sorted };
    }
    
    if (pairs === 1) {
      return { rank: 1, name: 'ãƒ¯ãƒ³ãƒšã‚¢', cards: sorted };
    }
    
    return { rank: 0, name: 'ãƒã‚¤ã‚«ãƒ¼ãƒ‰', cards: sorted };
  };
  
  // ã‚¹ãƒˆãƒ¬ãƒ¼ãƒˆåˆ¤å®š
  const checkStraight = (values: number[]): boolean => {
    const uniqueValues = Array.from(new Set(values)).sort((a, b) => b - a);
    if (uniqueValues.length < 5) return false;
    
    // é€šå¸¸ã®ã‚¹ãƒˆãƒ¬ãƒ¼ãƒˆ
    for (let i = 0; i <= uniqueValues.length - 5; i++) {
      if (uniqueValues[i] - uniqueValues[i + 4] === 4) return true;
    }
    
    // A-2-3-4-5ã®ã‚¹ãƒˆãƒ¬ãƒ¼ãƒˆ
    if (uniqueValues.includes(14) && uniqueValues.includes(5) && uniqueValues.includes(4) && 
        uniqueValues.includes(3) && uniqueValues.includes(2)) return true;
    
    return false;
  };
  
  // ã‚«ãƒ¼ãƒ‰ã®å€¤ã®å‡ºç¾å›æ•°ã‚’ã‚«ã‚¦ãƒ³ãƒˆ
  const getValueCounts = (values: number[]): { [key: number]: number } => {
    const counts: { [key: number]: number } = {};
    values.forEach(value => {
      counts[value] = (counts[value] || 0) + 1;
    });
    return counts;
  };
  
  // ãƒãƒ³ãƒ‰æ¯”è¼ƒ
  const compareHands = (hand1: HandRank, hand2: HandRank): number => {
    if (hand1.rank !== hand2.rank) return hand1.rank - hand2.rank;
    
    // åŒã˜å½¹ã®å ´åˆã€ã‚­ãƒƒã‚«ãƒ¼ã§æ¯”è¼ƒ
    const values1 = hand1.cards.map(c => c.value);
    const values2 = hand2.cards.map(c => c.value);
    
    for (let i = 0; i < Math.min(values1.length, values2.length); i++) {
      if (values1[i] !== values2[i]) {
        return values1[i] - values2[i];
      }
    }
    
    return 0;
  };

  // ãƒ™ãƒƒãƒˆé¡ï¼ˆå‹•çš„ï¼‰
  const [bets, setBets] = useState([
    { top: 628, left: 311, amount: 0 },
    { top: 681, left: 223, amount: 100 }, // SB
    { top: 628, left: 155, amount: 200 }, // BB
    { top: 389, left: 146, amount: 0 },
    { top: 216, left: 146, amount: 0 },
    { top: 216, left: 293, amount: 0 },
    { top: 389, left: 302, amount: 0 },
    { top: 145, left: 302, amount: 0 },
    { top: 145, left: 146, amount: 0 },
  ]);

  // ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆå‹•çš„ï¼‰
  const [actions, setActions] = useState([
    { text: "" },
    { text: "" },
    { text: "" },
    { text: "" },
    { text: "" },
    { text: "" },
    { text: "" },
    { text: "" },
    { text: "" },
  ]);

  // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹
  const [activePlayers, setActivePlayers] = useState([
    true, true, true, true, true, true, true, true, true
  ]);

  // ãƒœãƒ¼ãƒ‰ã‚«ãƒ¼ãƒ‰ï¼ˆå‹•çš„ï¼‰
  const [boardCards, setBoardCards] = useState<Card[]>([]);

  // ã‚«ãƒ¼ãƒ‰ã‚’é…ã‚‹
  const dealCards = () => {
    const newDeck = shuffleDeck(createDeck());
    setDeck(newDeck);
    setUsedCards([]);
    
    // å„ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã«2æšãšã¤é…ã‚‹
    const newHands: Card[][] = [];
    for (let i = 0; i < 9; i++) {
      const card1 = newDeck[i * 2];
      const card2 = newDeck[i * 2 + 1];
      newHands.push([card1, card2]);
    }
    setPlayerHands(newHands);
    setDeck(newDeck.slice(18)); // é…ã£ãŸã‚«ãƒ¼ãƒ‰ã‚’ãƒ‡ãƒƒã‚­ã‹ã‚‰é™¤å»
    
    console.log('ğŸƒ Cards dealt to all players');
  };
  
  // ãƒœãƒ¼ãƒ‰ã‚«ãƒ¼ãƒ‰ã‚’é…ã‚‹
  const dealBoardCards = (count: number) => {
    const newBoardCards = [...boardCards];
    for (let i = 0; i < count; i++) {
      const card = drawCard();
      if (card) newBoardCards.push(card);
    }
    setBoardCards(newBoardCards);
  };
  
  // æ–°ã—ã„ã‚²ãƒ¼ãƒ é–‹å§‹
  const startNewGame = () => {
    setGamePhase('PREFLOP');
    setBoardCards([]);
    
    // ã‚²ãƒ¼ãƒ è¨­å®šã«åŸºã¥ã„ã¦ãƒ–ãƒ©ã‚¤ãƒ³ãƒ‰ã‚’è¨­å®š
    const smallBlindAmount = gameSettings.blinds.small;
    const bigBlindAmount = gameSettings.blinds.big;
    const initialPot = smallBlindAmount + bigBlindAmount;
    
    setPot(initialPot);
    setBets(Array(9).fill({ amount: 0 }));
    setActions(Array(9).fill({ text: '' }));
    setActivePlayers(Array(9).fill(true));
    setCurrentTurn(0);
    
    // ãƒ‡ã‚£ãƒ¼ãƒ©ãƒ¼ãƒœã‚¿ãƒ³ã‚’æ™‚è¨ˆå›ã‚Šã«ç§»å‹•
    setDealerSeat(prev => (prev + 1) % 9);
    
    // ã‚«ãƒ¼ãƒ‰ã‚’é…ã‚‹
    dealCards();
    
    // ãƒ–ãƒ©ã‚¤ãƒ³ãƒ‰ã‚’è¨­å®š
    const newBets = Array(9).fill({ amount: 0 });
    if (smallBlindSeat !== 2 && smallBlindSeat !== 3) {
      newBets[smallBlindSeat] = { amount: smallBlindAmount };
    }
    if (bigBlindSeat !== 2 && bigBlindSeat !== 3) {
      newBets[bigBlindSeat] = { amount: bigBlindAmount };
    }
    setBets(newBets);
    
    const newActions = Array(9).fill({ text: '' });
    if (smallBlindSeat !== 2 && smallBlindSeat !== 3) {
      newActions[smallBlindSeat] = { text: 'SB' };
    }
    if (bigBlindSeat !== 2 && bigBlindSeat !== 3) {
      newActions[bigBlindSeat] = { text: 'BB' };
    }
    setActions(newActions);
    
    // ãƒãƒ£ãƒƒãƒˆã«æ–°ã—ã„ã‚²ãƒ¼ãƒ é–‹å§‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
    setChatMessages(prev => [...prev, { 
      user: 'ã‚·ã‚¹ãƒ†ãƒ ', 
      text: `æ–°ã—ã„ã‚²ãƒ¼ãƒ é–‹å§‹ï¼ãƒ–ãƒ©ã‚¤ãƒ³ãƒ‰ ${smallBlindAmount}/${bigBlindAmount}`, 
      time: new Date() 
    }]);
    
    console.log('ğŸ° New game started!');
  };

  // ãƒ†ãƒ¼ãƒ–ãƒ«è¨­å®šã®èª­ã¿è¾¼ã¿
  const loadTableSettings = async (tableId: string) => {
    // å®Ÿéš›ã®APIå‘¼ã³å‡ºã—ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ
    const mockTableData = {
      'table-1': {
        gameType: 'cash',
        blinds: { small: 50, big: 100 },
        buyIn: 5000,
        maxPlayers: 6,
        isPrivate: false,
      },
      'table-2': {
        gameType: 'cash',
        blinds: { small: 200, big: 400 },
        buyIn: 20000,
        maxPlayers: 9,
        isPrivate: true,
        password: 'poker123',
      },
      'tournament-1': {
        gameType: 'tournament',
        blinds: { small: 25, big: 50 },
        buyIn: 1000,
        maxPlayers: 45,
        isPrivate: false,
      },
    };

    const settings = mockTableData[tableId as keyof typeof mockTableData];
    if (settings) {
      setGameSettings(prev => ({ 
        ...prev, 
        gameType: settings.gameType as 'cash' | 'tournament' | 'sit-and-go',
        blinds: settings.blinds,
        buyIn: settings.buyIn,
        maxPlayers: settings.maxPlayers,
        isPrivate: settings.isPrivate,
        password: settings.password,
      }));
      
      // ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒ†ãƒ¼ãƒ–ãƒ«ã®å ´åˆã¯èªè¨¼ãŒå¿…è¦
      if (settings.isPrivate && !password) {
        setShowPasswordModal(true);
        setIsAuthenticated(false);
      }
    }
  };

  // ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰èªè¨¼
  const handlePasswordAuth = () => {
    const password = 'password' in gameSettings ? gameSettings.password : '';
    if (passwordInput === password) {
      setIsAuthenticated(true);
      setShowPasswordModal(false);
      setPasswordInput('');
      setAuthError('');
    } else {
      setAuthError('ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“');
    }
  };

  // ãƒˆãƒ¼ãƒŠãƒ¡ãƒ³ãƒˆãƒ¬ãƒ™ãƒ«é€²è¡Œ
  const advanceTournamentLevel = () => {
    if (gameSettings.tournamentSettings) {
      const currentLevel = gameSettings.tournamentSettings.currentLevel;
      const nextLevel = currentLevel + 1;
      
      if (nextLevel <= gameSettings.tournamentSettings.levels.length) {
        const newBlinds = gameSettings.tournamentSettings.levels[nextLevel - 1].blinds;
        setGameSettings(prev => ({
          ...prev,
          blinds: newBlinds,
          tournamentSettings: prev.tournamentSettings ? {
            ...prev.tournamentSettings,
            currentLevel: nextLevel,
          } : undefined,
        }));
        
        // ãƒãƒ£ãƒƒãƒˆã«é€šçŸ¥
        setChatMessages(prev => [...prev, {
          user: 'ã‚·ã‚¹ãƒ†ãƒ ',
          text: `ãƒ¬ãƒ™ãƒ«${nextLevel}ã«é€²è¡Œï¼ãƒ–ãƒ©ã‚¤ãƒ³ãƒ‰ ${newBlinds.small}/${newBlinds.big}`,
          time: new Date()
        }]);
      }
    }
  };

  // ãƒˆãƒ¼ãƒŠãƒ¡ãƒ³ãƒˆãƒ¬ãƒ™ãƒ«é€²è¡Œã®ã‚¿ã‚¤ãƒãƒ¼
  useEffect(() => {
    if (gameSettings.gameType === 'tournament' && gameSettings.tournamentSettings) {
      const timer = setInterval(() => {
        advanceTournamentLevel();
      }, 30000); // 30ç§’ã”ã¨ã«ãƒ¬ãƒ™ãƒ«é€²è¡Œï¼ˆãƒ†ã‚¹ãƒˆç”¨ï¼‰
      
      return () => clearInterval(timer);
    }
  }, [gameSettings.gameType, gameSettings.tournamentSettings]);

  // ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆåˆæœŸåŒ–æ™‚ã«ã‚²ãƒ¼ãƒ é–‹å§‹
  useEffect(() => {
    // ãƒ†ãƒ¼ãƒ–ãƒ«IDãŒã‚ã‚‹å ´åˆã¯è¨­å®šã‚’èª­ã¿è¾¼ã¿
    if (tableId) {
      loadTableSettings(tableId);
    }
    
    // èªè¨¼æ¸ˆã¿ã®å ´åˆã®ã¿ã‚²ãƒ¼ãƒ é–‹å§‹
    if (isAuthenticated) {
      startNewGame();
    }
  // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [tableId, isAuthenticated]);

  // ãƒãƒ³ãƒ‰å±¥æ­´ã«è¿½åŠ 
  const addToHandHistory = (winner: string, potAmount: number) => {
    const gameId = handHistory.length + 1;
    const finalHand = winner === 'You' ? evaluateHand(playerHands[0], boardCards).name : 'Hidden';
    
    const newHistoryEntry = {
      gameId,
      date: new Date(),
      winner,
      pot: potAmount,
      finalHand,
      boardCards: [...boardCards]
    };
    
    setHandHistory(prev => [newHistoryEntry, ...prev.slice(0, 49)]); // æœ€æ–°50ã‚²ãƒ¼ãƒ ã¾ã§ä¿æŒ
    
    // ç²å¾—é‡‘é¡çµ±è¨ˆæ›´æ–°
    setWinnings(prev => {
      const newStats = { ...prev };
      newStats.handsPlayed += 1;
      
      if (winner === 'You') {
        newStats.totalWon += potAmount;
        newStats.handsWon += 1;
      } else {
        newStats.totalLost += 200; // ä»®æƒ³çš„ãªå‚åŠ è²»
      }
      
      newStats.netProfit = newStats.totalWon - newStats.totalLost;
      newStats.winRate = (newStats.handsWon / newStats.handsPlayed) * 100;
      
      return newStats;
    });
  };

  // å‹è€…åˆ¤å®š
  const determineWinner = (): string => {
    const playerNames = ['You', 'Player 2', 'Player 3', 'Player 4', 'Player 5', 'Player 6', 'Player 7', 'Player 8', 'Player 9'];
    const activePlayerIndices = activePlayers.map((active, index) => active ? index : -1).filter(i => i !== -1);
    
    if (activePlayerIndices.length === 1) {
      return playerNames[activePlayerIndices[0]];
    }
    
    let bestPlayer = activePlayerIndices[0];
    let bestHand = evaluateHand(playerHands[bestPlayer], boardCards);
    
    for (let i = 1; i < activePlayerIndices.length; i++) {
      const playerIndex = activePlayerIndices[i];
      const hand = evaluateHand(playerHands[playerIndex], boardCards);
      
      if (compareHands(hand, bestHand) > 0) {
        bestPlayer = playerIndex;
        bestHand = hand;
      }
    }
    
    console.log(`ğŸ† Winner: ${playerNames[bestPlayer]} with ${bestHand.name}`);
    return playerNames[bestPlayer];
  };
  
  // ãƒ•ã‚§ãƒ¼ã‚ºé€²è¡Œ
  const advancePhase = () => {
    // ã‚²ãƒ¼ãƒ çŠ¶æ…‹æ¤œè¨¼
    if (!validateGameState() || !validateCards()) {
      console.error('âŒ Game validation failed, resetting...');
      startNewGame();
      return;
    }
    
    const phases: Array<'PREFLOP' | 'FLOP' | 'TURN' | 'RIVER' | 'SHOWDOWN'> = ['PREFLOP', 'FLOP', 'TURN', 'RIVER', 'SHOWDOWN'];
    const currentIndex = phases.indexOf(gamePhase);
    
    if (currentIndex < phases.length - 1) {
      const nextPhase = phases[currentIndex + 1];
      
      if (nextPhase === 'FLOP') {
        dealBoardCards(3);
        console.log('ğŸƒ Flop cards dealt');
      } else if (nextPhase === 'TURN') {
        dealBoardCards(1);
        console.log('ğŸƒ Turn card dealt');
      } else if (nextPhase === 'RIVER') {
        dealBoardCards(1);
        console.log('ğŸƒ River card dealt');
      } else if (nextPhase === 'SHOWDOWN') {
        // æœ€çµ‚æ¤œè¨¼
        if (!validateCards()) {
          console.error('âŒ Final card validation failed');
          return;
        }
        
        // å‹è€…åˆ¤å®š
        const winnerName = determineWinner();
        setWinner(winnerName);
        setShowWinner(true);
        
        // ãƒãƒ³ãƒ‰å±¥æ­´ã«è¿½åŠ 
        addToHandHistory(winnerName, pot);
        
        console.log('ğŸ† Showdown!', `Winner: ${winnerName}`, `Pot: $${pot}`);
        
        // 3ç§’å¾Œã«è‡ªå‹•çš„ã«æ–°ã—ã„ã‚²ãƒ¼ãƒ é–‹å§‹
        setTimeout(() => {
          setShowWinner(false);
          startNewGame();
        }, 3000);
      }
      
      setGamePhase(nextPhase);
      setCurrentTurn(1); // æ¬¡ã®ãƒ•ã‚§ãƒ¼ã‚ºã¯æ¬¡ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‹ã‚‰
    }
  };

  // Foldã‚¢ã‚¯ã‚·ãƒ§ãƒ³
  const handleFold = () => {
    const newActivePlayers = [...activePlayers];
    newActivePlayers[0] = false;
    setActivePlayers(newActivePlayers);
    
    const newActions = [...actions];
    newActions[0] = { text: 'ãƒ•ã‚©ãƒ¼ãƒ«ãƒ‰' };
    setActions(newActions);
    
    console.log('Player folded');
    setTimeout(() => advancePhase(), 1000);
  };

  // Callã‚¢ã‚¯ã‚·ãƒ§ãƒ³
  const handleCall = () => {
    const maxBet = Math.max(...bets.map(b => b.amount));
    const callAmount = maxBet > 0 ? maxBet : 100;
    
    const newBets = [...bets];
    newBets[0].amount = callAmount;
    setBets(newBets);
    
    setPot(prev => prev + callAmount);
    
    const newActions = [...actions];
    newActions[0] = { text: 'ã‚³ãƒ¼ãƒ«' };
    setActions(newActions);
    
    console.log(`Player called $${callAmount}`);
    setTimeout(() => advancePhase(), 1000);
  };

  // Raiseãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯ï¼ˆã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼è¡¨ç¤ºï¼‰
  const handleRaiseClick = () => {
    setRaiseAmount(gameSettings.blinds.big * 2);
    setShowRaiseSlider(true);
  };

  // Raiseç¢ºå®š
  const handleRaiseConfirm = () => {
    setShowRaiseSlider(false);
    setAnimatingChips(true);
    
    const isAllIn = raiseAmount >= myStack;
    
    const newBets = [...bets];
    newBets[0].amount = raiseAmount;
    setBets(newBets);
    
    setTimeout(() => {
      setPot(prev => prev + raiseAmount);
      setAnimatingChips(false);
      
      const newActions = [...actions];
      newActions[0] = { text: isAllIn ? `ã‚ªãƒ¼ãƒ«ã‚¤ãƒ³ $${raiseAmount}` : `ãƒ¬ã‚¤ã‚º $${raiseAmount}` };
      setActions(newActions);
      
      console.log(isAllIn ? `Player went all-in $${raiseAmount}` : `Player raised $${raiseAmount}`);
      setTimeout(() => advancePhase(), 1000);
    }, 800);
  };

  // ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¯ã‚·ãƒ§ãƒ³
  const handleCheck = () => {
    const newActions = [...actions];
    newActions[0] = { text: 'ãƒã‚§ãƒƒã‚¯' };
    setActions(newActions);
    
    const newPlayerStatuses = [...playerStatuses];
    newPlayerStatuses[0].lastAction = 'ãƒã‚§ãƒƒã‚¯';
    setPlayerStatuses(newPlayerStatuses);
    
    console.log('Player checked');
    setTimeout(() => {
      advancePhase();
      simulateAIPlayers();
    }, 1000);
  };
  
  // AIãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®è‡ªå‹•ã‚¢ã‚¯ã‚·ãƒ§ãƒ³
  const simulateAIPlayers = () => {
    const aiPlayers = playerStatuses.slice(1).filter(player => player.isOnline && player.stack > 0);
    
    aiPlayers.forEach((player, index) => {
      setTimeout(() => {
        const playerIndex = player.id;
        const action = getAIAction(playerIndex);
        executeAIAction(playerIndex, action);
      }, (index + 1) * 1500); // 1.5ç§’é–“éš”ã§é †æ¬¡å®Ÿè¡Œ
    });
  };
  
  // AIã®è¡Œå‹•æ±ºå®š
  const getAIAction = (playerIndex: number): string => {
    const player = playerStatuses[playerIndex];
    const hand = playerHands[playerIndex];
    const handStrength = evaluateHandStrength(hand);
    const random = Math.random();
    
    // ãƒãƒ³ãƒ‰å¼·åº¦ã«åŸºã¥ãè¡Œå‹•æ±ºå®š
    if (handStrength > 0.8) {
      return random > 0.3 ? 'ãƒ¬ã‚¤ã‚º' : 'ã‚³ãƒ¼ãƒ«';
    } else if (handStrength > 0.6) {
      return random > 0.6 ? 'ãƒ¬ã‚¤ã‚º' : random > 0.3 ? 'ã‚³ãƒ¼ãƒ«' : 'ãƒã‚§ãƒƒã‚¯';
    } else if (handStrength > 0.4) {
      return random > 0.7 ? 'ãƒ•ã‚©ãƒ¼ãƒ«ãƒ‰' : random > 0.4 ? 'ã‚³ãƒ¼ãƒ«' : 'ãƒã‚§ãƒƒã‚¯';
    } else {
      return random > 0.5 ? 'ãƒ•ã‚©ãƒ¼ãƒ«ãƒ‰' : 'ãƒã‚§ãƒƒã‚¯';
    }
  };
  
  // ãƒãƒ³ãƒ‰å¼·åº¦è©•ä¾¡ï¼ˆç°¡æ˜“ç‰ˆï¼‰
  const evaluateHandStrength = (hand: Card[]): number => {
    if (hand.length < 2) return 0;
    
    const [card1, card2] = hand;
    let strength = 0;
    
    // ãƒšã‚¢
    if (card1.value === card2.value) {
      strength += 0.5;
      if (card1.value >= 10) strength += 0.3; // é«˜ãƒšã‚¢
    }
    
    // ã‚¹ãƒ¼ãƒˆ
    if (card1.suit === card2.suit) {
      strength += 0.2;
    }
    
    // ãƒã‚¤ã‚«ãƒ¼ãƒ‰
    if (card1.value >= 11 || card2.value >= 11) {
      strength += 0.2;
    }
    
    // ã‚¹ãƒˆãƒ¬ãƒ¼ãƒˆãƒ‰ãƒ­ãƒ¼
    const diff = Math.abs(card1.value - card2.value);
    if (diff <= 4 && diff > 0) {
      strength += 0.1;
    }
    
    return Math.min(strength, 1);
  };
  
  // AIã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å®Ÿè¡Œ
  const executeAIAction = (playerIndex: number, action: string) => {
    const newPlayerStatuses = [...playerStatuses];
    newPlayerStatuses[playerIndex].lastAction = action;
    newPlayerStatuses[playerIndex].isThinking = true;
    setPlayerStatuses(newPlayerStatuses);
    
    setTimeout(() => {
      const newPlayerStatuses = [...playerStatuses];
      newPlayerStatuses[playerIndex].isThinking = false;
      setPlayerStatuses(newPlayerStatuses);
      
      const newActions = [...actions];
      newActions[playerIndex] = { text: action };
      setActions(newActions);
      
      // ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã«å¿œã˜ãŸå‡¦ç†
      if (action === 'ãƒ•ã‚©ãƒ¼ãƒ«ãƒ‰') {
        const newActivePlayers = [...activePlayers];
        newActivePlayers[playerIndex] = false;
        setActivePlayers(newActivePlayers);
      } else if (action === 'ã‚³ãƒ¼ãƒ«') {
        const newBets = [...bets];
        const callAmount = Math.max(...bets.map(b => b.amount));
        newBets[playerIndex].amount = callAmount;
        setBets(newBets);
        setPot(prev => prev + callAmount);
      } else if (action === 'ãƒ¬ã‚¤ã‚º') {
        const newBets = [...bets];
        const raiseAmount = Math.max(...bets.map(b => b.amount)) + 200;
        newBets[playerIndex].amount = raiseAmount;
        setBets(newBets);
        setPot(prev => prev + raiseAmount);
      }
      
      console.log(`${playerStatuses[playerIndex].name} ${action}`);
    }, 1000);
  };

  // ãƒãƒ£ãƒƒãƒˆé€ä¿¡
  const handleSendMessage = () => {
    if (chatMessage.trim()) {
      setChatMessages(prev => [...prev, { 
        user: 'You', 
        text: chatMessage, 
        time: new Date() 
      }]);
      setChatMessage('');
    }
  };
  
  // ã‚·ã‚§ã‚¢æ©Ÿèƒ½
  const handleShare = () => {
    const shareText = `ğŸ° SIN JAPAN POKER ã§ãƒ—ãƒ¬ã‚¤ä¸­ï¼
ğŸ† ç²å¾—é‡‘é¡: $${winnings.totalWon}
ğŸ“Š å‹ç‡: ${winnings.winRate.toFixed(1)}%
ğŸ® ãƒ—ãƒ¬ã‚¤ã—ãŸãƒãƒ³ãƒ‰æ•°: ${winnings.handsPlayed}

#SINJAPANPOKER #ãƒãƒ¼ã‚«ãƒ¼`;

    if (navigator.share) {
      navigator.share({
        title: 'SIN JAPAN POKER',
        text: shareText,
        url: window.location.href
      });
    } else {
      // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼
      navigator.clipboard.writeText(shareText).then(() => {
        alert('çµ±è¨ˆæƒ…å ±ã‚’ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼');
      });
    }
  };
  
  // ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é–‰ã˜ã‚‹
  const closeAllMenus = () => {
    setShowMenu(false);
    setShowHandHistory(false);
    setShowWinnings(false);
    setShowShare(false);
    setShowRules(false);
  };

  // Figmaã‹ã‚‰ã®æ­£ç¢ºãªåº§æ¨™ãƒ‡ãƒ¼ã‚¿ï¼ˆiPhone 14 Pro Max: 430px Ã— 932pxï¼‰+ å³ã«35pxèª¿æ•´ + ä¸‹ã«30pxèª¿æ•´
  // æ™‚è¨ˆå›ã‚Šã®é †ç•ª: ä¸‹ä¸­å¤® â†’ ä¸‹å·¦ â†’ å·¦ä¸­ â†’ å·¦ä¸Š â†’ ä¸Šå·¦ â†’ ä¸Šå³ â†’ å³ä¸Š â†’ å³ä¸­ â†’ ä¸‹å³
  const seats = [
  {
    id: 0,
      position: { top: 802, left: 220 },
      name: "You",
      stack: { top: 831, left: 221, amount: 2000 },
      avatar: "ğŸ‘¤",
      color: "from-green-500 to-green-700",
  },
  {
    id: 1,
      position: { top: 683, left: 50 },
      name: "Player 2",
      stack: { top: 714, left: 50, amount: 1200 },
      hand: { top: 646, left: 125 },
      avatar: "ğŸ˜",
      color: "from-purple-500 to-purple-700",
  },
  {
    id: 2,
      position: { top: 452, left: 51 },
      name: "Player 3",
      stack: { top: 485, left: 51, amount: 1800 },
      hand: { top: 421, left: 117 },
      avatar: "ğŸ¤ ",
      color: "from-orange-500 to-orange-700",
  },
  {
    id: 3,
      position: { top: 246, left: 56 },
      name: "Player 4",
      stack: { top: 280, left: 54, amount: 1600 },
      hand: { top: 211, left: 109 },
      avatar: "ğŸ²",
      color: "from-red-500 to-red-700",
  },
  {
    id: 4,
      position: { top: 101, left: 138 },
      name: "Player 5",
      stack: { top: 137, left: 139, amount: 1900 },
      hand: { top: 65, left: 185 },
      avatar: "ğŸƒ",
      color: "from-indigo-500 to-indigo-700",
  },
  {
    id: 5,
      position: { top: 103, left: 294 },
      name: "Player 6",
      stack: { top: 139, left: 294, amount: 1700 },
      hand: { top: 68, left: 289 },
      avatar: "ğŸª",
      color: "from-teal-500 to-teal-700",
  },
  {
    id: 6,
      position: { top: 244, left: 375 },
      name: "Player 7",
      stack: { top: 280, left: 375, amount: 1400 },
      hand: { top: 211, left: 364 },
      avatar: "ğŸ°",
      color: "from-pink-500 to-pink-700",
  },
  {
    id: 7,
      position: { top: 451, left: 375 },
      name: "Player 8",
      stack: { top: 477, left: 375, amount: 1300 },
      hand: { top: 417, left: 364 },
      avatar: "ğŸŒŸ",
      color: "from-yellow-500 to-yellow-700",
  },
  {
    id: 8,
      position: { top: 683, left: 375 },
      name: "Player 9",
      stack: { top: 722, left: 375, amount: 1500 },
      hand: { top: 757, left: 319 },
      avatar: "ğŸ¯",
      color: "from-blue-500 to-blue-700",
    },
  ];

  // èªè¨¼ãŒå¿…è¦ãªå ´åˆã¯ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’è¡¨ç¤º
  if (!isAuthenticated) {
    return (
      <div className="relative w-[430px] h-[932px] mx-auto overflow-hidden bg-black">
        <div className="absolute inset-0 flex items-center justify-center z-50">
          <div className="bg-gray-900 rounded-xl shadow-2xl w-full max-w-md p-6">
            <h2 className="text-white text-xl font-bold mb-4 text-center">ğŸ”’ ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒ†ãƒ¼ãƒ–ãƒ«</h2>
            <div className="space-y-4">
              <div>
                <label className="text-white text-sm font-medium mb-2 block">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰</label>
                <input
                  type="password"
                  value={passwordInput}
                  onChange={(e) => setPasswordInput(e.target.value)}
                  onKeyPress={(e) => e.key === 'Enter' && handlePasswordAuth()}
                  className="w-full px-4 py-3 bg-gray-800 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-blue-500"
                  placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›"
                />
                {authError && (
                  <p className="text-red-400 text-sm mt-2">{authError}</p>
                )}
              </div>
              <div className="grid grid-cols-2 gap-3">
                <button
                  onClick={() => window.location.href = '/lobby'}
                  className="bg-gray-600 hover:bg-gray-500 text-white font-bold py-3 px-4 rounded-lg transition-colors"
                >
                  ã‚­ãƒ£ãƒ³ã‚»ãƒ«
                </button>
                <button
                  onClick={handlePasswordAuth}
                  className="bg-blue-600 hover:bg-blue-500 text-white font-bold py-3 px-4 rounded-lg transition-colors"
                >
                  å‚åŠ 
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    );
  }

  return (
    <div className="relative w-[430px] h-[932px] mx-auto overflow-hidden">
      {/* èƒŒæ™¯ç”»åƒ */}
      <img
        className="absolute top-0 left-0 w-full h-full object-cover"
        alt="Poker Table"
        src="/poker-bg.png"
      />

      {/* è¦³æˆ¦ãƒ¢ãƒ¼ãƒ‰ãƒãƒŠãƒ¼ */}
      {gameSettings.isSpectating && (
        <div className="absolute top-4 left-1/2 -translate-x-1/2 z-30">
          <div className="bg-red-600 text-white px-4 py-2 rounded-full text-sm font-bold shadow-lg">
            ğŸ‘ï¸ è¦³æˆ¦ãƒ¢ãƒ¼ãƒ‰
          </div>
        </div>
      )}

      {/* ãƒˆãƒ¼ãƒŠãƒ¡ãƒ³ãƒˆæƒ…å ± */}
      {gameSettings.gameType === 'tournament' && gameSettings.tournamentSettings && (
        <div className="absolute top-4 left-4 z-30">
          <div className="bg-black/80 backdrop-blur-md rounded-lg p-3 text-white">
            <div className="text-sm font-bold mb-1">ğŸ† ãƒˆãƒ¼ãƒŠãƒ¡ãƒ³ãƒˆ</div>
            <div className="text-xs space-y-1">
              <div>ãƒ¬ãƒ™ãƒ«: {gameSettings.tournamentSettings.currentLevel}</div>
              <div>ãƒ–ãƒ©ã‚¤ãƒ³ãƒ‰: {gameSettings.tournamentSettings.levels[gameSettings.tournamentSettings.currentLevel - 1].blinds.small}/{gameSettings.tournamentSettings.levels[gameSettings.tournamentSettings.currentLevel - 1].blinds.big}</div>
              <div>æ®‹ã‚Š: {gameSettings.tournamentSettings.playersRemaining}äºº</div>
              <div>è³é‡‘: ${gameSettings.tournamentSettings.prizePool}</div>
            </div>
          </div>
        </div>
      )}

      {/* ãƒ†ãƒ¼ãƒ–ãƒ«æƒ…å ± */}
      {gameSettings.tableId && (
        <div className="absolute top-4 right-4 z-30">
          <div className="bg-black/80 backdrop-blur-md rounded-lg p-3 text-white">
            <div className="text-sm font-bold mb-1">ğŸ¯ {gameSettings.tableId}</div>
            <div className="text-xs space-y-1">
              <div>ãƒ–ãƒ©ã‚¤ãƒ³ãƒ‰: {gameSettings.blinds.small}/{gameSettings.blinds.big}</div>
              <div>å‚åŠ è²»: ${gameSettings.buyIn}</div>
              <div>æœ€å¤§: {gameSettings.maxPlayers}äºº</div>
              {gameSettings.isPrivate && (
                <div className="text-blue-400">ğŸ”’ ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆ</div>
              )}
            </div>
          </div>
        </div>
      )}

      {/* ã‚²ãƒ¼ãƒ ãƒ•ã‚§ãƒ¼ã‚ºè¡¨ç¤ºï¼ˆæœ€ä¸Šéƒ¨ï¼‰ */}
      <div className="absolute top-2 left-1/2 -translate-x-1/2 z-50">
        <motion.div
          initial={{ scale: 0.8, opacity: 0 }}
          animate={{ scale: 1, opacity: 1 }}
          transition={{ type: "spring", stiffness: 300 }}
          className="bg-gradient-to-r from-sky-400 via-cyan-500 to-blue-600 px-4 py-1 rounded-full border-2 border-white/60 shadow-lg backdrop-blur-xl"
        >
          <div className="text-white text-xs font-bold tracking-wider flex items-center gap-2">
            {gamePhase === 'PREFLOP' ? 'ãƒ—ãƒªãƒ•ãƒ­ãƒƒãƒ—' :
             gamePhase === 'FLOP' ? 'ãƒ•ãƒ­ãƒƒãƒ—' :
             gamePhase === 'TURN' ? 'ã‚¿ãƒ¼ãƒ³' :
             gamePhase === 'RIVER' ? 'ãƒªãƒãƒ¼' : 'ã‚·ãƒ§ãƒ¼ãƒ€ã‚¦ãƒ³'}
          </div>
        </motion.div>
      </div>

      {/* å·¦ä¸Šï¼šãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒœã‚¿ãƒ³ */}
      <motion.button
        onClick={() => setShowMenu(!showMenu)}
        whileHover={{ scale: 1.05 }}
        whileTap={{ scale: 0.95 }}
        className="absolute top-4 left-4 w-14 h-14 bg-gradient-to-br from-sky-500/95 to-cyan-600/95 backdrop-blur-xl rounded-2xl flex items-center justify-center text-white shadow-2xl border-2 border-sky-300/60 hover:border-sky-200/80 transition-all z-50"
      >
        <svg className="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2.5} d="M4 6h16M4 12h16M4 18h16" />
        </svg>
      </motion.button>

      {/* å³ä¸Šï¼šãƒãƒ£ãƒƒãƒˆãƒœã‚¿ãƒ³ */}
      <motion.button
        onClick={() => setShowChat(!showChat)}
        whileHover={{ scale: 1.05 }}
        whileTap={{ scale: 0.95 }}
        className="absolute top-4 right-4 w-14 h-14 bg-gradient-to-br from-blue-500/95 to-sky-600/95 backdrop-blur-xl rounded-2xl flex items-center justify-center text-white shadow-2xl border-2 border-blue-300/60 hover:border-blue-200/80 transition-all z-50"
      >
        <svg className="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2.5} d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" />
        </svg>
      </motion.button>

      {/* æ´—ç·´ã•ã‚ŒãŸãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒ‘ãƒãƒ« */}
      {showMenu && (
        <motion.div 
          initial={{ x: -256, opacity: 0 }}
          animate={{ x: 0, opacity: 1 }}
          exit={{ x: -256, opacity: 0 }}
          transition={{ type: "spring", stiffness: 300, damping: 30 }}
          className="absolute top-0 left-0 w-64 h-full bg-gradient-to-br from-slate-900/95 via-blue-900/95 to-slate-900/95 backdrop-blur-xl z-40 shadow-2xl border-r border-sky-400/30"
        >
          <div className="p-4">
            <div className="flex items-center justify-between mb-6">
              <h2 className="text-white text-lg font-bold bg-gradient-to-r from-sky-300 to-cyan-300 bg-clip-text text-transparent">
                âš™ï¸ ãƒ¡ãƒ‹ãƒ¥ãƒ¼
              </h2>
              <button 
                onClick={closeAllMenus}
                className="w-8 h-8 rounded-full bg-gradient-to-br from-red-500/80 to-red-600/80 flex items-center justify-center text-white text-lg hover:from-red-400 hover:to-red-500 transition-all duration-200 shadow-lg"
              >
                Ã—
              </button>
            </div>
            
            <div className="space-y-3">
              <button 
                onClick={() => setShowHandHistory(true)}
                className="w-full text-left px-4 py-3 bg-gradient-to-r from-blue-500/20 to-cyan-500/20 hover:from-blue-400/30 hover:to-cyan-400/30 rounded-xl text-white font-semibold transition-all duration-200 border border-blue-400/30 hover:border-blue-300/50 shadow-lg backdrop-blur-sm"
              >
                ğŸ“Š ãƒãƒ³ãƒ‰å±¥æ­´
              </button>

              <button 
                onClick={() => setShowWinnings(true)}
                className="w-full text-left px-4 py-3 bg-gradient-to-r from-green-500/20 to-emerald-500/20 hover:from-green-400/30 hover:to-emerald-400/30 rounded-xl text-white font-semibold transition-all duration-200 border border-green-400/30 hover:border-green-300/50 shadow-lg backdrop-blur-sm"
              >
                ğŸ’° ç²å¾—é‡‘é¡
              </button>

              <button 
                onClick={handleShare}
                className="w-full text-left px-4 py-3 bg-gradient-to-r from-purple-500/20 to-pink-500/20 hover:from-purple-400/30 hover:to-pink-400/30 rounded-xl text-white font-semibold transition-all duration-200 border border-purple-400/30 hover:border-purple-300/50 shadow-lg backdrop-blur-sm"
              >
                ğŸ“¤ ã‚·ã‚§ã‚¢
              </button>

              <button 
                onClick={() => setShowStats(true)}
                className="w-full text-left px-4 py-3 bg-gradient-to-r from-orange-500/20 to-yellow-500/20 hover:from-orange-400/30 hover:to-yellow-400/30 rounded-xl text-white font-semibold transition-all duration-200 border border-orange-400/30 hover:border-orange-300/50 shadow-lg backdrop-blur-sm"
              >
                ğŸ“Š çµ±è¨ˆ
              </button>

              <button 
                onClick={() => setShowSettings(true)}
                className="w-full text-left px-4 py-3 bg-gradient-to-r from-gray-500/20 to-slate-500/20 hover:from-gray-400/30 hover:to-slate-400/30 rounded-xl text-white font-semibold transition-all duration-200 border border-gray-400/30 hover:border-gray-300/50 shadow-lg backdrop-blur-sm"
              >
                âš™ï¸ è¨­å®š
              </button>

              <button 
                onClick={() => setShowRules(true)}
                className="w-full text-left px-4 py-3 bg-gradient-to-r from-indigo-500/20 to-blue-500/20 hover:from-indigo-400/30 hover:to-blue-400/30 rounded-xl text-white font-semibold transition-all duration-200 border border-indigo-400/30 hover:border-indigo-300/50 shadow-lg backdrop-blur-sm"
              >
                ğŸ“– ã‚²ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ«
              </button>
              
              <button
                onClick={() => window.location.href = '/lobby'}
                className="w-full text-left px-4 py-3 bg-gradient-to-r from-red-500/80 to-red-600/80 hover:from-red-400 hover:to-red-500 rounded-xl text-white font-semibold transition-all duration-200 shadow-lg border border-red-400/50 hover:border-red-300/70"
              >
                ğŸšª ãƒ­ãƒ“ãƒ¼ã«æˆ»ã‚‹
              </button>
            </div>
          </div>
        </motion.div>
      )}

      {/* æ´—ç·´ã•ã‚ŒãŸãƒãƒ³ãƒ‰å±¥æ­´ãƒ‘ãƒãƒ« */}
      {showHandHistory && (
        <motion.div 
          initial={{ opacity: 0 }}
          animate={{ opacity: 1 }}
          exit={{ opacity: 0 }}
          className="absolute inset-0 bg-gradient-to-br from-slate-900/95 via-blue-900/95 to-slate-900/95 backdrop-blur-xl z-50 flex items-center justify-center p-4"
        >
          <motion.div 
            initial={{ scale: 0.9, opacity: 0, y: 20 }}
            animate={{ scale: 1, opacity: 1, y: 0 }}
            exit={{ scale: 0.9, opacity: 0, y: 20 }}
            transition={{ type: "spring", stiffness: 300, damping: 30 }}
            className="bg-gradient-to-br from-slate-800/95 to-slate-900/95 rounded-2xl shadow-2xl w-full max-w-2xl max-h-[80vh] overflow-hidden border border-sky-400/30"
          >
            {/* ãƒ˜ãƒƒãƒ€ãƒ¼ */}
            <div className="flex items-center justify-between p-6 border-b border-sky-400/20 bg-gradient-to-r from-blue-600/20 to-cyan-600/20">
              <h2 className="text-white text-2xl font-bold bg-gradient-to-r from-blue-300 to-cyan-300 bg-clip-text text-transparent">
                ğŸ“Š ãƒãƒ³ãƒ‰å±¥æ­´
              </h2>
              <button 
                onClick={() => setShowHandHistory(false)}
                className="w-10 h-10 rounded-full bg-gradient-to-br from-red-500/80 to-red-600/80 flex items-center justify-center text-white text-xl hover:from-red-400 hover:to-red-500 transition-all duration-200 shadow-lg"
              >
                Ã—
              </button>
            </div>
            
            {/* ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ */}
            <div className="p-6 overflow-y-auto max-h-[60vh]">
              {handHistory.length === 0 ? (
                <div className="text-center py-12">
                  <div className="w-16 h-16 mx-auto mb-4 rounded-full bg-gradient-to-br from-blue-500/20 to-cyan-500/20 flex items-center justify-center">
                    <span className="text-3xl">ğŸ“Š</span>
                  </div>
                  <p className="text-white/70 text-lg">ã¾ã ã‚²ãƒ¼ãƒ å±¥æ­´ãŒã‚ã‚Šã¾ã›ã‚“</p>
                  <p className="text-white/50 text-sm mt-2">ã‚²ãƒ¼ãƒ ã‚’ãƒ—ãƒ¬ã‚¤ã™ã‚‹ã¨å±¥æ­´ãŒè¡¨ç¤ºã•ã‚Œã¾ã™</p>
                </div>
              ) : (
                <div className="space-y-4">
                  {handHistory.map((hand, index) => (
                    <motion.div 
                      key={hand.gameId}
                      initial={{ opacity: 0, y: 10 }}
                      animate={{ opacity: 1, y: 0 }}
                      transition={{ delay: index * 0.1 }}
                      className="bg-gradient-to-r from-slate-700/50 to-slate-600/50 rounded-xl p-4 border border-slate-500/30 shadow-lg backdrop-blur-sm hover:from-slate-600/60 hover:to-slate-500/60 transition-all duration-200"
                    >
                      <div className="flex items-center justify-between mb-3">
                        <span className="text-white font-bold text-lg">ã‚²ãƒ¼ãƒ  #{hand.gameId}</span>
                        <span className="text-white/70 text-sm bg-slate-800/50 px-3 py-1 rounded-full">
                          {hand.date.toLocaleTimeString()}
                        </span>
                      </div>
                      <div className="grid grid-cols-2 gap-4 text-sm">
                        <div className="bg-slate-800/30 rounded-lg p-3">
                          <span className="text-white/70 block mb-1">å‹è€…</span>
                          <span className={`font-bold text-lg ${hand.winner === 'You' ? 'text-green-400 bg-gradient-to-r from-green-400 to-emerald-400 bg-clip-text text-transparent' : 'text-white'}`}>
                            {hand.winner}
                          </span>
                        </div>
                        <div className="bg-slate-800/30 rounded-lg p-3">
                          <span className="text-white/70 block mb-1">ãƒãƒƒãƒˆ</span>
                          <span className="text-yellow-400 font-bold text-lg bg-gradient-to-r from-yellow-400 to-orange-400 bg-clip-text text-transparent">
                            ${hand.pot}
                          </span>
                        </div>
                        {hand.winner === 'You' && (
                          <div className="col-span-2 bg-slate-800/30 rounded-lg p-3">
                            <span className="text-white/70 text-sm block mb-1">æ‰‹æœ­</span>
                            <span className="text-green-400 font-semibold bg-gradient-to-r from-green-400 to-emerald-400 bg-clip-text text-transparent">
                              {hand.finalHand}
                            </span>
                          </div>
                        )}
                      </div>
                    </motion.div>
                  ))}
                </div>
              )}
            </div>
          </motion.div>
        </motion.div>
      )}

      {/* æ´—ç·´ã•ã‚ŒãŸç²å¾—é‡‘é¡ãƒ‘ãƒãƒ« */}
      {showWinnings && (
        <motion.div 
          initial={{ opacity: 0 }}
          animate={{ opacity: 1 }}
          exit={{ opacity: 0 }}
          className="absolute inset-0 bg-gradient-to-br from-slate-900/95 via-green-900/95 to-slate-900/95 backdrop-blur-xl z-50 flex items-center justify-center p-4"
        >
          <motion.div 
            initial={{ scale: 0.9, opacity: 0, y: 20 }}
            animate={{ scale: 1, opacity: 1, y: 0 }}
            exit={{ scale: 0.9, opacity: 0, y: 20 }}
            transition={{ type: "spring", stiffness: 300, damping: 30 }}
            className="bg-gradient-to-br from-slate-800/95 to-slate-900/95 rounded-2xl shadow-2xl w-full max-w-md overflow-hidden border border-green-400/30"
          >
            {/* ãƒ˜ãƒƒãƒ€ãƒ¼ */}
            <div className="flex items-center justify-between p-6 border-b border-green-400/20 bg-gradient-to-r from-green-600/20 to-emerald-600/20">
              <h2 className="text-white text-2xl font-bold bg-gradient-to-r from-green-300 to-emerald-300 bg-clip-text text-transparent">
                ğŸ’° ç²å¾—é‡‘é¡
              </h2>
              <button 
                onClick={() => setShowWinnings(false)}
                className="w-10 h-10 rounded-full bg-gradient-to-br from-red-500/80 to-red-600/80 flex items-center justify-center text-white text-xl hover:from-red-400 hover:to-red-500 transition-all duration-200 shadow-lg"
              >
                Ã—
              </button>
            </div>
            
            {/* ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ */}
            <div className="p-6 space-y-6">
              <div className="grid grid-cols-2 gap-4">
                <motion.div 
                  initial={{ opacity: 0, x: -20 }}
                  animate={{ opacity: 1, x: 0 }}
                  transition={{ delay: 0.1 }}
                  className="bg-gradient-to-br from-green-500/20 to-emerald-500/20 rounded-xl p-4 text-center border border-green-400/30 shadow-lg backdrop-blur-sm"
                >
                  <div className="text-green-400 text-3xl font-bold bg-gradient-to-r from-green-400 to-emerald-400 bg-clip-text text-transparent">
                    ${winnings.totalWon}
                  </div>
                  <div className="text-white/70 text-sm mt-1">ç·ç²å¾—é‡‘é¡</div>
                </motion.div>
                <motion.div 
                  initial={{ opacity: 0, x: 20 }}
                  animate={{ opacity: 1, x: 0 }}
                  transition={{ delay: 0.2 }}
                  className="bg-gradient-to-br from-red-500/20 to-pink-500/20 rounded-xl p-4 text-center border border-red-400/30 shadow-lg backdrop-blur-sm"
                >
                  <div className="text-red-400 text-3xl font-bold bg-gradient-to-r from-red-400 to-pink-400 bg-clip-text text-transparent">
                    ${winnings.totalLost}
                  </div>
                  <div className="text-white/70 text-sm mt-1">ç·æå¤±é‡‘é¡</div>
                </motion.div>
              </div>
              
              <motion.div 
                initial={{ opacity: 0, y: 20 }}
                animate={{ opacity: 1, y: 0 }}
                transition={{ delay: 0.3 }}
                className={`rounded-xl p-6 text-center border shadow-lg backdrop-blur-sm ${
                  winnings.netProfit >= 0 
                    ? 'bg-gradient-to-br from-green-500/20 to-emerald-500/20 border-green-400/30' 
                    : 'bg-gradient-to-br from-red-500/20 to-pink-500/20 border-red-400/30'
                }`}
              >
                <div className={`text-4xl font-bold ${
                  winnings.netProfit >= 0 
                    ? 'text-green-400 bg-gradient-to-r from-green-400 to-emerald-400 bg-clip-text text-transparent' 
                    : 'text-red-400 bg-gradient-to-r from-red-400 to-pink-400 bg-clip-text text-transparent'
                }`}>
                  ${winnings.netProfit >= 0 ? '+' : ''}{winnings.netProfit}
                </div>
                <div className="text-white/70 text-lg mt-2">ç´”åˆ©ç›Š</div>
              </motion.div>
              
              <div className="grid grid-cols-2 gap-4">
                <motion.div 
                  initial={{ opacity: 0, y: 20 }}
                  animate={{ opacity: 1, y: 0 }}
                  transition={{ delay: 0.4 }}
                  className="bg-gradient-to-br from-blue-500/20 to-cyan-500/20 rounded-xl p-4 text-center border border-blue-400/30 shadow-lg backdrop-blur-sm"
                >
                  <div className="text-blue-400 text-2xl font-bold bg-gradient-to-r from-blue-400 to-cyan-400 bg-clip-text text-transparent">
                    {winnings.handsPlayed}
                  </div>
                  <div className="text-white/70 text-sm mt-1">ãƒ—ãƒ¬ã‚¤ã—ãŸãƒãƒ³ãƒ‰</div>
                </motion.div>
                <motion.div 
                  initial={{ opacity: 0, y: 20 }}
                  animate={{ opacity: 1, y: 0 }}
                  transition={{ delay: 0.5 }}
                  className="bg-gradient-to-br from-purple-500/20 to-pink-500/20 rounded-xl p-4 text-center border border-purple-400/30 shadow-lg backdrop-blur-sm"
                >
                  <div className="text-purple-400 text-2xl font-bold bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text text-transparent">
                    {winnings.winRate.toFixed(1)}%
                  </div>
                  <div className="text-white/70 text-sm mt-1">å‹ç‡</div>
                </motion.div>
              </div>
            </div>
          </motion.div>
        </motion.div>
      )}

      {/* æ´—ç·´ã•ã‚ŒãŸã‚²ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ«ãƒ‘ãƒãƒ« */}
      {showRules && (
        <motion.div 
          initial={{ opacity: 0 }}
          animate={{ opacity: 1 }}
          exit={{ opacity: 0 }}
          className="absolute inset-0 bg-gradient-to-br from-slate-900/95 via-indigo-900/95 to-slate-900/95 backdrop-blur-xl z-50 flex items-center justify-center p-4"
        >
          <motion.div 
            initial={{ scale: 0.9, opacity: 0, y: 20 }}
            animate={{ scale: 1, opacity: 1, y: 0 }}
            exit={{ scale: 0.9, opacity: 0, y: 20 }}
            transition={{ type: "spring", stiffness: 300, damping: 30 }}
            className="bg-gradient-to-br from-slate-800/95 to-slate-900/95 rounded-2xl shadow-2xl w-full max-w-2xl max-h-[80vh] overflow-hidden border border-indigo-400/30"
          >
            {/* ãƒ˜ãƒƒãƒ€ãƒ¼ */}
            <div className="flex items-center justify-between p-6 border-b border-indigo-400/20 bg-gradient-to-r from-indigo-600/20 to-blue-600/20">
              <h2 className="text-white text-2xl font-bold bg-gradient-to-r from-indigo-300 to-blue-300 bg-clip-text text-transparent">
                ğŸ“– ã‚²ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ«
              </h2>
              <button 
                onClick={() => setShowRules(false)}
                className="w-10 h-10 rounded-full bg-gradient-to-br from-red-500/80 to-red-600/80 flex items-center justify-center text-white text-xl hover:from-red-400 hover:to-red-500 transition-all duration-200 shadow-lg"
              >
                Ã—
              </button>
            </div>
            
            {/* ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ */}
            <div className="p-6 overflow-y-auto max-h-[60vh] space-y-6">
              <motion.div 
                initial={{ opacity: 0, x: -20 }}
                animate={{ opacity: 1, x: 0 }}
                transition={{ delay: 0.1 }}
                className="bg-gradient-to-r from-yellow-500/10 to-orange-500/10 rounded-xl p-5 border border-yellow-400/30 backdrop-blur-sm"
              >
                <h3 className="text-xl font-bold mb-3 bg-gradient-to-r from-yellow-400 to-orange-400 bg-clip-text text-transparent">
                  ğŸ¯ åŸºæœ¬ãƒ«ãƒ¼ãƒ«
                </h3>
                <ul className="space-y-2 text-white">
                  <li className="flex items-start gap-2">
                    <span className="text-yellow-400 mt-1">â€¢</span>
                    <span>ãƒ†ã‚­ã‚µã‚¹ãƒ›ãƒ¼ãƒ«ãƒ‡ãƒ ãƒãƒ¼ã‚«ãƒ¼</span>
                  </li>
                  <li className="flex items-start gap-2">
                    <span className="text-yellow-400 mt-1">â€¢</span>
                    <span>å„ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã«2æšã®æ‰‹æœ­ã‚’é…å¸ƒ</span>
                  </li>
                  <li className="flex items-start gap-2">
                    <span className="text-yellow-400 mt-1">â€¢</span>
                    <span>ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã‚«ãƒ¼ãƒ‰5æšã‚’é †æ¬¡å…¬é–‹</span>
                  </li>
                  <li className="flex items-start gap-2">
                    <span className="text-yellow-400 mt-1">â€¢</span>
                    <span>æœ€å¼·ã®5æšã§ãƒãƒ³ãƒ‰ã‚’æ§‹æˆ</span>
                  </li>
                </ul>
              </motion.div>
              
              <motion.div 
                initial={{ opacity: 0, x: 20 }}
                animate={{ opacity: 1, x: 0 }}
                transition={{ delay: 0.2 }}
                className="bg-gradient-to-r from-green-500/10 to-emerald-500/10 rounded-xl p-5 border border-green-400/30 backdrop-blur-sm"
              >
                <h3 className="text-xl font-bold mb-3 bg-gradient-to-r from-green-400 to-emerald-400 bg-clip-text text-transparent">
                  ğŸ® ã‚²ãƒ¼ãƒ é€²è¡Œ
                </h3>
                <ul className="space-y-2 text-white">
                  <li className="flex items-start gap-2">
                    <span className="text-green-400 mt-1">â€¢</span>
                    <span><strong>PREFLOP:</strong> æ‰‹æœ­ã®ã¿ã§ãƒ™ãƒƒãƒˆ</span>
                  </li>
                  <li className="flex items-start gap-2">
                    <span className="text-green-400 mt-1">â€¢</span>
                    <span><strong>FLOP:</strong> ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã‚«ãƒ¼ãƒ‰3æšå…¬é–‹</span>
                  </li>
                  <li className="flex items-start gap-2">
                    <span className="text-green-400 mt-1">â€¢</span>
                    <span><strong>TURN:</strong> ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã‚«ãƒ¼ãƒ‰4æšç›®å…¬é–‹</span>
                  </li>
                  <li className="flex items-start gap-2">
                    <span className="text-green-400 mt-1">â€¢</span>
                    <span><strong>RIVER:</strong> ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã‚«ãƒ¼ãƒ‰5æšç›®å…¬é–‹</span>
                  </li>
                  <li className="flex items-start gap-2">
                    <span className="text-green-400 mt-1">â€¢</span>
                    <span><strong>SHOWDOWN:</strong> æœ€å¼·ãƒãƒ³ãƒ‰ã§å‹è€…æ±ºå®š</span>
                  </li>
                </ul>
              </motion.div>
              
              <motion.div 
                initial={{ opacity: 0, y: 20 }}
                animate={{ opacity: 1, y: 0 }}
                transition={{ delay: 0.3 }}
                className="bg-gradient-to-r from-blue-500/10 to-cyan-500/10 rounded-xl p-5 border border-blue-400/30 backdrop-blur-sm"
              >
                <h3 className="text-xl font-bold mb-3 bg-gradient-to-r from-blue-400 to-cyan-400 bg-clip-text text-transparent">
                  ğŸƒ ãƒãƒ³ãƒ‰ãƒ©ãƒ³ã‚¯
                </h3>
                <div className="grid grid-cols-1 sm:grid-cols-2 gap-2 text-white text-sm">
                  <div className="flex items-center gap-2">
                    <span className="text-blue-400 font-bold w-6">1.</span>
                    <span>ãƒ­ã‚¤ãƒ¤ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ãƒˆãƒ•ãƒ©ãƒƒã‚·ãƒ¥</span>
                  </div>
                  <div className="flex items-center gap-2">
                    <span className="text-blue-400 font-bold w-6">2.</span>
                    <span>ã‚¹ãƒˆãƒ¬ãƒ¼ãƒˆãƒ•ãƒ©ãƒƒã‚·ãƒ¥</span>
                  </div>
                  <div className="flex items-center gap-2">
                    <span className="text-blue-400 font-bold w-6">3.</span>
                    <span>ãƒ•ã‚©ãƒ¼ã‚«ãƒ¼ãƒ‰</span>
                  </div>
                  <div className="flex items-center gap-2">
                    <span className="text-blue-400 font-bold w-6">4.</span>
                    <span>ãƒ•ãƒ«ãƒã‚¦ã‚¹</span>
                  </div>
                  <div className="flex items-center gap-2">
                    <span className="text-blue-400 font-bold w-6">5.</span>
                    <span>ãƒ•ãƒ©ãƒƒã‚·ãƒ¥</span>
                  </div>
                  <div className="flex items-center gap-2">
                    <span className="text-blue-400 font-bold w-6">6.</span>
                    <span>ã‚¹ãƒˆãƒ¬ãƒ¼ãƒˆ</span>
                  </div>
                  <div className="flex items-center gap-2">
                    <span className="text-blue-400 font-bold w-6">7.</span>
                    <span>ã‚¹ãƒªãƒ¼ã‚«ãƒ¼ãƒ‰</span>
                  </div>
                  <div className="flex items-center gap-2">
                    <span className="text-blue-400 font-bold w-6">8.</span>
                    <span>ãƒ„ãƒ¼ãƒšã‚¢</span>
                  </div>
                  <div className="flex items-center gap-2">
                    <span className="text-blue-400 font-bold w-6">9.</span>
                    <span>ãƒ¯ãƒ³ãƒšã‚¢</span>
                  </div>
                  <div className="flex items-center gap-2">
                    <span className="text-blue-400 font-bold w-6">10.</span>
                    <span>ãƒã‚¤ã‚«ãƒ¼ãƒ‰</span>
                  </div>
                </div>
              </motion.div>
            </div>
          </motion.div>
        </motion.div>
      )}

      {/* æ´—ç·´ã•ã‚ŒãŸãƒãƒ£ãƒƒãƒˆãƒ‘ãƒãƒ« */}
      {showChat && (
        <motion.div 
          initial={{ x: 320, opacity: 0 }}
          animate={{ x: 0, opacity: 1 }}
          exit={{ x: 320, opacity: 0 }}
          transition={{ type: "spring", stiffness: 300, damping: 30 }}
          className="absolute top-0 right-0 w-80 h-full bg-gradient-to-br from-slate-900/95 via-blue-900/95 to-slate-900/95 backdrop-blur-xl z-40 shadow-2xl border-l border-sky-400/30 flex flex-col"
        >
          {/* ãƒ˜ãƒƒãƒ€ãƒ¼ */}
          <div className="p-4 border-b border-sky-400/20 bg-gradient-to-r from-sky-600/20 to-cyan-600/20">
            <div className="flex items-center justify-between">
              <h2 className="text-white text-lg font-bold bg-gradient-to-r from-sky-300 to-cyan-300 bg-clip-text text-transparent">
                ğŸ’¬ ãƒãƒ£ãƒƒãƒˆ
              </h2>
              <button
                onClick={() => setShowChat(false)}
                className="w-8 h-8 rounded-full bg-gradient-to-br from-red-500/80 to-red-600/80 flex items-center justify-center text-white text-lg hover:from-red-400 hover:to-red-500 transition-all duration-200 shadow-lg"
              >
                Ã—
              </button>
            </div>
          </div>
          
          {/* ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¨ãƒªã‚¢ */}
          <div className="flex-1 overflow-y-auto p-4 space-y-3">
            {chatMessages.map((msg, index) => (
              <motion.div 
                key={index}
                initial={{ opacity: 0, y: 10 }}
                animate={{ opacity: 1, y: 0 }}
                transition={{ delay: index * 0.1 }}
                className={`p-3 rounded-xl shadow-lg backdrop-blur-sm ${
                  msg.user === 'ã‚·ã‚¹ãƒ†ãƒ ' 
                    ? 'bg-gradient-to-r from-blue-500/20 to-cyan-500/20 border border-blue-400/30' 
                    : 'bg-gradient-to-r from-slate-700/50 to-slate-600/50 border border-slate-500/30'
                }`}
              >
                <div className={`text-xs font-bold mb-1 ${
                  msg.user === 'ã‚·ã‚¹ãƒ†ãƒ ' 
                    ? 'text-blue-300 bg-gradient-to-r from-blue-400 to-cyan-400 bg-clip-text text-transparent' 
                    : 'text-green-300 bg-gradient-to-r from-green-400 to-emerald-400 bg-clip-text text-transparent'
                }`}>
                  {msg.user}
                </div>
                <div className="text-white text-sm leading-relaxed">{msg.text}</div>
              </motion.div>
            ))}
          </div>
          
          {/* å…¥åŠ›ã‚¨ãƒªã‚¢ */}
          <div className="p-4 border-t border-sky-400/20 bg-gradient-to-r from-slate-800/50 to-slate-700/50">
            <div className="flex gap-2">
              <input
                type="text"
                value={chatMessage}
                onChange={(e) => setChatMessage(e.target.value)}
                onKeyPress={(e) => e.key === 'Enter' && handleSendMessage()}
                placeholder="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›..."
                className="flex-1 bg-gradient-to-r from-slate-800/80 to-slate-700/80 text-white px-4 py-3 rounded-xl border border-sky-400/30 focus:border-sky-300/60 focus:outline-none focus:ring-2 focus:ring-sky-400/30 backdrop-blur-sm placeholder-slate-400"
              />
              <button
                onClick={handleSendMessage}
                className="bg-gradient-to-r from-sky-500 to-cyan-500 text-white px-4 py-3 rounded-xl hover:from-sky-400 hover:to-cyan-400 transition-all duration-200 shadow-lg border border-sky-300/30 font-semibold"
              >
                é€ä¿¡
              </button>
            </div>
          </div>
        </motion.div>
      )}

      {/* ãƒœãƒ¼ãƒ‰ã‚«ãƒ¼ãƒ‰ï¼ˆãƒ—ãƒªãƒ•ãƒ­ãƒƒãƒ—ä»¥å¤–ã§è¡¨ç¤ºï¼‰ */}
      {gamePhase !== 'PREFLOP' && (
        <div className="absolute top-[460px] left-[106px] z-20">
          <div className="flex gap-2">
            <AnimatePresence>
              {boardCards.map((card, index) => (
                <motion.div
                  key={index}
                  initial={{ rotateY: 180, y: -100, scale: 0 }}
                  animate={{ rotateY: 0, y: 0, scale: 1 }}
                  transition={{ delay: index * 0.2, type: 'spring' }}
                  className="w-12 h-16 bg-white rounded-lg shadow-lg border-2 border-gray-300 flex flex-col items-center justify-center"
                >
                  <div className={`text-xl font-bold ${card.color === 'red' ? 'text-red-600' : 'text-black'}`}>
                    {card.rank}
                  </div>
                  <div className={`text-2xl ${card.color === 'red' ? 'text-red-600' : 'text-black'}`}>
                    {card.suit}
                  </div>
                </motion.div>
              ))}
            </AnimatePresence>
          </div>
        </div>
      )}

      {/* ãƒãƒƒãƒˆé¡ï¼ˆãƒœãƒ¼ãƒ‰ã‚«ãƒ¼ãƒ‰ã®ä¸‹ãƒ»å›ºå®šä½ç½®ï¼‰ */}
      <div className="absolute top-[540px] left-1/2 -translate-x-1/2 z-20">
            <motion.div
          key={pot}
          initial={{ scale: 1.2 }}
          animate={{ scale: 1 }}
          className="bg-gradient-to-br from-sky-400 via-cyan-500 to-blue-500 px-6 py-3 rounded-xl shadow-xl border-2 border-sky-300/50"
        >
          <div className="text-white text-xs font-bold text-center">POT</div>
          <div className="text-white text-2xl font-bold text-center">${pot}</div>
        </motion.div>
      </div>

      {/* ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼åº§å¸­ */}
      {seats.map((seat) => (
        <React.Fragment key={seat.id}>
          {/* ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚³ãƒ³ãƒ†ãƒŠ */}
          <div
            className="absolute"
                  style={{
              top: `${seat.position.top}px`,
              left: `${seat.position.left}px`,
              transform: 'translate(-50%, -50%)',
            }}
          >
            <div className="flex items-center gap-3">
              {/* Youã®å ´åˆï¼šå·¦å´ã«å¤§ãã„æ‰‹æœ­ */}
              {seat.id === 0 && playerHands[0] && playerHands[0].length > 0 && (
                <div className="flex gap-2 mr-3">
                  {playerHands[seat.id].map((card, i) => (
                    <motion.div 
                      key={i}
                      initial={{ rotateY: 180, x: -50 }}
                      animate={{ rotateY: 0, x: 0 }}
                      transition={{ delay: i * 0.2, type: 'spring' }}
                      className="w-16 h-24 bg-white rounded-lg shadow-xl border-2 border-gray-300 flex flex-col items-center justify-center"
                    >
                      <div className={`text-2xl font-bold ${card.color === 'red' ? 'text-red-600' : 'text-black'}`}>
                        {card.rank}
                      </div>
                      <div className={`text-4xl ${card.color === 'red' ? 'text-red-600' : 'text-black'}`}>
                        {card.suit}
                      </div>
                    </motion.div>
                  ))}
                </div>
              )}
              
              {/* ä¸­å¤®ï¼šã‚¢ãƒã‚¿ãƒ¼ã¨ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æƒ…å ±ï¼ˆå›ºå®šãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼‰ */}
              <div className="flex flex-col items-center min-h-[120px] justify-start">
                
                {/* ä¸¸ã„ã‚¢ãƒã‚¿ãƒ¼ï¼ˆå›ºå®šä½ç½®ï¼‰ */}
                <div className={`w-16 h-16 rounded-full bg-gradient-to-br ${seat.color} flex items-center justify-center text-3xl shadow-lg border-4 border-white/30 relative`} style={{ transform: 'none' }}>
                  {seat.avatar}
                </div>

                {/* ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼åã¨ãƒœã‚¿ãƒ³ */}
                <div className="flex items-center gap-2 mt-3">
                  <div className="text-white text-sm sm:text-base font-bold whitespace-nowrap bg-gradient-to-r from-sky-600/80 to-cyan-700/80 px-3 py-1 rounded-lg border border-sky-400/50 shadow-lg backdrop-blur-sm">
                    {seat.name}
                  </div>
                  {seat.id === dealerSeat && (
                    <div className="w-6 h-6 rounded-full bg-gradient-to-br from-sky-400 to-cyan-600 flex items-center justify-center text-white text-xs font-bold shadow-lg border-2 border-sky-300">
                      D
                    </div>
                  )}
                  {seat.id === smallBlindSeat && seat.id !== 2 && seat.id !== 3 && (
                    <div className="w-6 h-6 rounded-full bg-gradient-to-br from-blue-500 to-blue-700 flex items-center justify-center text-white text-xs font-bold shadow-lg border-2 border-blue-300">
                      SB
                    </div>
                  )}
                  {seat.id === bigBlindSeat && seat.id !== 2 && seat.id !== 3 && (
                    <div className="w-6 h-6 rounded-full bg-gradient-to-br from-red-500 to-red-700 flex items-center justify-center text-white text-xs font-bold shadow-lg border-2 border-red-300">
                      BB
                    </div>
                  )}
                </div>

                {/* ã‚¹ã‚¿ãƒƒã‚¯é¡ */}
                <div className="text-white text-sm sm:text-base font-black whitespace-nowrap mt-2 bg-gradient-to-r from-cyan-600/80 to-blue-700/80 px-3 py-1 rounded-lg border border-cyan-400/50 shadow-lg backdrop-blur-sm">
                  ${seat.stack.amount}
                    </div>
                
                {/* ä»–ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®æ‰‹æœ­ï¼ˆã‚¢ãƒã‚¿ãƒ¼ã®ä¸‹ï¼‰ */}
                {seat.id !== 0 && (
                  <div className="flex gap-1 mt-3">
                    {[1, 2].map((_, i) => (
                      <div
                        key={i}
                        className="w-8 h-11 bg-gradient-to-br from-sky-500 to-cyan-600 rounded shadow-lg border border-sky-300/50"
                      />
                      ))}
                    </div>
                  )}
              </div>
              
              {/* ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼7,8,9ã®å ´åˆã¯å·¦å´ã«é…ç½®ã€ãã®ä»–ã¯å³å´ */}
              {(seat.id >= 6 && seat.id <= 8) ? (
                /* å·¦å´ï¼šãƒ™ãƒƒãƒˆé¡ã¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼7,8,9ï¼‰ */
                <div className="flex flex-col items-start gap-1 min-h-[40px] justify-start ml-3">
                  {/* ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒ©ãƒ™ãƒ«ï¼ˆãƒ™ãƒƒãƒˆã®ä¸Šï¼‰ */}
                  {actions[seat.id].text && (
                    <div className="text-white text-sm font-bold whitespace-nowrap bg-gradient-to-r from-sky-500 to-cyan-600 px-2 py-1 rounded border border-sky-300/50 shadow-lg">
                      {actions[seat.id].text}
                    </div>
                  )}
                  
                  {/* ãƒ™ãƒƒãƒˆé¡ */}
                  {bets[seat.id].amount > 0 && (
                    <div className="bg-gradient-to-r from-cyan-500 to-blue-600 text-white px-3 py-1 rounded-full text-xs font-bold shadow-lg flex items-center gap-1 border border-cyan-300/50">
                      ${bets[seat.id].amount}
                      <span className="text-base">ğŸª™</span>
                    </div>
                  )}
                </div>
              ) : (
                /* å³å´ï¼šãƒ™ãƒƒãƒˆé¡ã¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆãã®ä»–ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ï¼‰ */
                <div className="flex flex-col items-start gap-1 min-h-[40px] justify-start">
                  {/* ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒ©ãƒ™ãƒ«ï¼ˆãƒ™ãƒƒãƒˆã®ä¸Šï¼‰ */}
                  {actions[seat.id].text && seat.id !== 2 && seat.id !== 3 && (
                    <div className="text-white text-sm font-bold whitespace-nowrap bg-gradient-to-r from-sky-500 to-cyan-600 px-2 py-1 rounded border border-sky-300/50 shadow-lg">
                      {actions[seat.id].text}
                    </div>
                  )}
                  
                  {/* ãƒ™ãƒƒãƒˆé¡ */}
                  {bets[seat.id].amount > 0 && seat.id !== 2 && seat.id !== 3 && (
                    <div className="bg-gradient-to-r from-cyan-500 to-blue-600 text-white px-3 py-1 rounded-full text-xs font-bold shadow-lg flex items-center gap-1 border border-cyan-300/50">
                      ${bets[seat.id].amount}
                      <span className="text-base">ğŸª™</span>
                    </div>
                  )}
                </div>
              )}
              </div>
        </div>
        </React.Fragment>
      ))}

      {/* ãƒãƒƒãƒ—ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */}
      <AnimatePresence>
        {animatingChips && (
          <motion.div
            initial={{ opacity: 1, y: 0 }}
            animate={{ opacity: 0, y: -200 }}
            exit={{ opacity: 0 }}
            transition={{ duration: 0.8 }}
            className="absolute bottom-40 left-1/2 -translate-x-1/2 text-6xl z-50"
          >
            ğŸª™
          </motion.div>
        )}
      </AnimatePresence>

      {/* å‹è€…è¡¨ç¤º */}
      <AnimatePresence>
        {showWinner && (
          <motion.div
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
            exit={{ opacity: 0 }}
            className="absolute inset-0 bg-black/80 flex items-center justify-center z-50"
          >
            <motion.div
              initial={{ scale: 0, rotate: -180 }}
              animate={{ scale: 1, rotate: 0 }}
              className="bg-gradient-to-br from-yellow-400 to-orange-600 p-8 rounded-2xl shadow-2xl text-center"
            >
              <div className="text-6xl mb-4">ğŸ†</div>
              <div className="text-white text-3xl font-bold mb-2">å‹è€…!</div>
              <div className="text-white text-2xl font-semibold">{winner}</div>
              <div className="text-white text-xl mt-2">ãƒãƒƒãƒˆ: ${pot}</div>
              <button
                onClick={() => window.location.reload()}
                className="mt-6 bg-white text-black font-bold py-2 px-6 rounded-lg hover:bg-gray-200"
              >
                æ–°ã—ã„ãƒãƒ³ãƒ‰
              </button>
            </motion.div>
          </motion.div>
        )}
      </AnimatePresence>

      {/* ç”»é¢ä¸‹ï¼šã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ï¼ˆè¦³æˆ¦ãƒ¢ãƒ¼ãƒ‰ã§ã¯è¡¨ç¤ºã—ãªã„ï¼‰ */}
      {!gameSettings.isSpectating && (
        <div className="absolute bottom-0 left-0 right-0 p-4 bg-black/80 backdrop-blur-md z-30">
        {/* ãƒ¬ã‚¤ã‚ºé¡ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ï¼ˆãƒ¬ã‚¤ã‚ºãƒœã‚¿ãƒ³æŠ¼ä¸‹æ™‚ã®ã¿è¡¨ç¤ºï¼‰ */}
      <AnimatePresence>
          {showRaiseSlider && (
          <motion.div
              initial={{ height: 0, opacity: 0 }}
              animate={{ height: 'auto', opacity: 1 }}
              exit={{ height: 0, opacity: 0 }}
              className="mb-3 overflow-hidden"
            >
              <div className="bg-gradient-to-r from-sky-900/95 via-cyan-900/95 to-blue-900/95 p-4 rounded-2xl border-2 border-sky-400/70 backdrop-blur-xl shadow-2xl">
                <div className="flex items-center justify-between mb-3">
                  <span className="text-white text-base font-bold flex items-center gap-2">
                    <span>ãƒ¬ã‚¤ã‚ºé¡</span>
                  </span>
                  <div className="bg-gradient-to-r from-sky-400 via-cyan-500 to-blue-500 px-3 py-2 rounded-xl border border-sky-300/50">
                    <span className="text-white text-xl font-black">${raiseAmount}</span>
                  </div>
            </div>
                <div className="relative">
                  <input
                    type="range"
                    min={gameSettings.blinds.big * 2}
                    max={myStack}
                    step="50"
                    value={raiseAmount}
                    onChange={(e) => setRaiseAmount(parseInt(e.target.value))}
                    className="w-full h-4 bg-gradient-to-r from-gray-700 to-gray-600 rounded-full appearance-none cursor-pointer slider"
                    style={{
                      background: `linear-gradient(to right, #0ea5e9 0%, #0ea5e9 ${((raiseAmount - gameSettings.blinds.big * 2) / (myStack - gameSettings.blinds.big * 2)) * 100}%, #374151 ${((raiseAmount - gameSettings.blinds.big * 2) / (myStack - gameSettings.blinds.big * 2)) * 100}%, #374151 100%)`
                    }}
                  />
                  <div className="flex justify-between text-sm text-gray-300 mt-3 mb-4">
                    <span className="bg-gray-800 px-3 py-1 rounded-lg">æœ€å°: ${gameSettings.blinds.big * 2}</span>
                    <span className="bg-gradient-to-r from-sky-400 to-blue-500 text-white px-3 py-1 rounded-lg font-bold border border-sky-300/50">æœ€å¤§: ${myStack}</span>
                  </div>
                </div>
                <div className="grid grid-cols-2 gap-3">
                  <motion.button
                    whileHover={{ scale: 1.05 }}
                    whileTap={{ scale: 0.95 }}
                    onClick={() => setShowRaiseSlider(false)}
                    className="bg-gradient-to-r from-gray-600 to-gray-700 text-white font-bold py-2 px-4 rounded-xl shadow-xl border-2 border-gray-400/50 hover:shadow-gray-500/30 hover:shadow-xl transition-all text-sm"
                  >
                    <span className="flex items-center justify-center">
                      <span>ã‚­ãƒ£ãƒ³ã‚»ãƒ«</span>
                    </span>
                  </motion.button>
                  <motion.button
                    whileHover={{ scale: 1.05 }}
                    whileTap={{ scale: 0.95 }}
                    onClick={handleRaiseConfirm}
                    className="bg-gradient-to-r from-sky-500 via-cyan-500 to-blue-500 text-white font-bold py-2 px-4 rounded-xl shadow-xl border-2 border-sky-300/60 hover:shadow-sky-400/40 hover:shadow-xl transition-all text-sm"
                  >
                    <span className="flex items-center justify-center">
                      <span>ç¢ºå®š</span>
                    </span>
                  </motion.button>
                </div>
            </div>
          </motion.div>
        )}
      </AnimatePresence>

        <div className="flex w-full">
          {/* Foldãƒœã‚¿ãƒ³ - èµ¤ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ */}
          <motion.button 
            onClick={handleFold}
            whileHover={{ scale: 1.02 }}
            whileTap={{ scale: 0.98 }}
            className="bg-gradient-to-r from-red-500 to-red-600 text-white font-bold py-3 flex-1 rounded-none shadow-xl border-r border-red-400/60 hover:shadow-red-500/40 transition-all backdrop-blur-sm text-sm"
          >
            <span className="flex items-center justify-center">
              <span>ãƒ•ã‚©ãƒ¼ãƒ«ãƒ‰</span>
            </span>
          </motion.button>
          
          {/* Checkãƒœã‚¿ãƒ³ - ç·‘ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ */}
          <motion.button 
            onClick={handleCheck}
            whileHover={{ scale: 1.02 }}
            whileTap={{ scale: 0.98 }}
            className="bg-gradient-to-r from-green-500 to-green-600 text-white font-bold py-3 flex-1 rounded-none shadow-xl border-r border-green-400/60 hover:shadow-green-500/40 transition-all backdrop-blur-sm text-sm"
          >
            <span className="flex items-center justify-center">
              <span>ãƒã‚§ãƒƒã‚¯</span>
            </span>
          </motion.button>
          
          {/* Callãƒœã‚¿ãƒ³ - ç·‘ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ */}
          <motion.button 
            onClick={handleCall}
            whileHover={{ scale: 1.02 }}
            whileTap={{ scale: 0.98 }}
            className="bg-gradient-to-r from-green-500 to-green-600 text-white font-bold py-3 flex-1 rounded-none shadow-xl border-r border-green-400/60 hover:shadow-green-500/40 transition-all backdrop-blur-sm text-sm"
          >
            <span className="flex items-center justify-center">
              <span>ã‚³ãƒ¼ãƒ«</span>
            </span>
          </motion.button>
          
          {/* Raiseãƒœã‚¿ãƒ³ - æ°´è‰²ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ */}
          <motion.button 
            onClick={handleRaiseClick}
            whileHover={{ scale: 1.02 }}
            whileTap={{ scale: 0.98 }}
            className="bg-gradient-to-r from-sky-500 to-cyan-600 text-white font-bold py-3 flex-1 rounded-none shadow-xl hover:shadow-sky-500/40 transition-all backdrop-blur-sm text-sm"
          >
            <span className="flex items-center justify-center">
              <span>ãƒ¬ã‚¤ã‚º</span>
            </span>
          </motion.button>
        </div>
        </div>
      )}

      {/* è¦³æˆ¦ãƒ¢ãƒ¼ãƒ‰ç”¨ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ‘ãƒãƒ« */}
      {gameSettings.isSpectating && (
        <div className="absolute bottom-0 left-0 right-0 p-4 bg-black/80 backdrop-blur-md z-30">
          <div className="grid grid-cols-3 gap-3">
            <button
              onClick={() => window.location.href = '/lobby'}
              className="bg-gray-600 hover:bg-gray-500 text-white font-bold py-3 px-4 rounded-lg transition-colors"
            >
              ãƒ­ãƒ“ãƒ¼ã«æˆ»ã‚‹
            </button>
            <button
              onClick={() => setShowChat(true)}
              className="bg-blue-600 hover:bg-blue-500 text-white font-bold py-3 px-4 rounded-lg transition-colors"
            >
              ãƒãƒ£ãƒƒãƒˆ
            </button>
            <button
              onClick={handleShare}
              className="bg-green-600 hover:bg-green-500 text-white font-bold py-3 px-4 rounded-lg transition-colors"
            >
              ã‚·ã‚§ã‚¢
            </button>
          </div>
        </div>
      )}

      {/* æ´—ç·´ã•ã‚ŒãŸçµ±è¨ˆãƒ‘ãƒãƒ« */}
      {showStats && (
        <motion.div 
          initial={{ opacity: 0 }}
          animate={{ opacity: 1 }}
          exit={{ opacity: 0 }}
          className="absolute inset-0 bg-gradient-to-br from-slate-900/95 via-orange-900/95 to-slate-900/95 backdrop-blur-xl z-50 flex items-center justify-center p-4"
        >
          <motion.div 
            initial={{ scale: 0.9, opacity: 0, y: 20 }}
            animate={{ scale: 1, opacity: 1, y: 0 }}
            exit={{ scale: 0.9, opacity: 0, y: 20 }}
            transition={{ type: "spring", stiffness: 300, damping: 30 }}
            className="bg-gradient-to-br from-slate-800/95 to-slate-900/95 rounded-2xl shadow-2xl max-w-md mx-4 overflow-hidden border border-orange-400/30"
          >
            {/* ãƒ˜ãƒƒãƒ€ãƒ¼ */}
            <div className="flex items-center justify-between p-6 border-b border-orange-400/20 bg-gradient-to-r from-orange-600/20 to-yellow-600/20">
              <h2 className="text-white text-2xl font-bold bg-gradient-to-r from-orange-300 to-yellow-300 bg-clip-text text-transparent">
                ğŸ“Š ãƒ—ãƒ¬ã‚¤çµ±è¨ˆ
              </h2>
              <button
                onClick={() => setShowStats(false)}
                className="w-10 h-10 rounded-full bg-gradient-to-br from-red-500/80 to-red-600/80 flex items-center justify-center text-white text-xl hover:from-red-400 hover:to-red-500 transition-all duration-200 shadow-lg"
              >
                Ã—
              </button>
            </div>
            
            {/* ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ */}
            <div className="p-6 text-white space-y-6">
              <div className="grid grid-cols-2 gap-4">
                <motion.div 
                  initial={{ opacity: 0, scale: 0.9 }}
                  animate={{ opacity: 1, scale: 1 }}
                  transition={{ delay: 0.1 }}
                  className="bg-gradient-to-br from-blue-500/20 to-cyan-500/20 p-4 rounded-xl border border-blue-400/30 shadow-lg backdrop-blur-sm"
                >
                  <div className="text-blue-400 text-sm font-bold mb-1">ãƒ—ãƒ¬ã‚¤ãƒãƒ³ãƒ‰æ•°</div>
                  <div className="text-white text-2xl font-bold bg-gradient-to-r from-blue-400 to-cyan-400 bg-clip-text text-transparent">
                    {gameStats.handsPlayed}
                  </div>
                </motion.div>
                <motion.div 
                  initial={{ opacity: 0, scale: 0.9 }}
                  animate={{ opacity: 1, scale: 1 }}
                  transition={{ delay: 0.2 }}
                  className="bg-gradient-to-br from-green-500/20 to-emerald-500/20 p-4 rounded-xl border border-green-400/30 shadow-lg backdrop-blur-sm"
                >
                  <div className="text-green-400 text-sm font-bold mb-1">å‹åˆ©ãƒãƒ³ãƒ‰æ•°</div>
                  <div className="text-white text-2xl font-bold bg-gradient-to-r from-green-400 to-emerald-400 bg-clip-text text-transparent">
                    {gameStats.handsWon}
                  </div>
                </motion.div>
                <motion.div 
                  initial={{ opacity: 0, scale: 0.9 }}
                  animate={{ opacity: 1, scale: 1 }}
                  transition={{ delay: 0.3 }}
                  className="bg-gradient-to-br from-yellow-500/20 to-orange-500/20 p-4 rounded-xl border border-yellow-400/30 shadow-lg backdrop-blur-sm"
                >
                  <div className="text-yellow-400 text-sm font-bold mb-1">å‹ç‡</div>
                  <div className="text-white text-2xl font-bold bg-gradient-to-r from-yellow-400 to-orange-400 bg-clip-text text-transparent">
                    {gameStats.handsPlayed > 0 ? ((gameStats.handsWon / gameStats.handsPlayed) * 100).toFixed(1) : 0}%
                  </div>
                </motion.div>
                <motion.div 
                  initial={{ opacity: 0, scale: 0.9 }}
                  animate={{ opacity: 1, scale: 1 }}
                  transition={{ delay: 0.4 }}
                  className="bg-gradient-to-br from-purple-500/20 to-pink-500/20 p-4 rounded-xl border border-purple-400/30 shadow-lg backdrop-blur-sm"
                >
                  <div className="text-purple-400 text-sm font-bold mb-1">ç·ç²å¾—é¡</div>
                  <div className="text-white text-2xl font-bold bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text text-transparent">
                    ${gameStats.totalWinnings}
                  </div>
                </motion.div>
              </div>
              
              <motion.div 
                initial={{ opacity: 0, y: 20 }}
                animate={{ opacity: 1, y: 0 }}
                transition={{ delay: 0.5 }}
                className="bg-gradient-to-r from-slate-700/50 to-slate-600/50 p-5 rounded-xl border border-slate-500/30 shadow-lg backdrop-blur-sm"
              >
                <div className="text-gray-300 text-lg font-bold mb-3 bg-gradient-to-r from-gray-300 to-slate-300 bg-clip-text text-transparent">
                  ãƒ—ãƒ¬ã‚¤çµ±è¨ˆ
                </div>
                <div className="space-y-3">
                  <div className="flex justify-between items-center">
                    <span className="text-gray-400 font-semibold">VPIP:</span>
                    <span className="text-white font-bold text-lg bg-gradient-to-r from-blue-400 to-cyan-400 bg-clip-text text-transparent">
                      {gameStats.vpip.toFixed(1)}%
                    </span>
                  </div>
                  <div className="flex justify-between items-center">
                    <span className="text-gray-400 font-semibold">PFR:</span>
                    <span className="text-white font-bold text-lg bg-gradient-to-r from-green-400 to-emerald-400 bg-clip-text text-transparent">
                      {gameStats.pfr.toFixed(1)}%
                    </span>
                  </div>
                </div>
              </motion.div>
            </div>
          </motion.div>
        </motion.div>
      )}

      {/* æ´—ç·´ã•ã‚ŒãŸè¨­å®šãƒ‘ãƒãƒ« */}
      {showSettings && (
        <motion.div 
          initial={{ opacity: 0 }}
          animate={{ opacity: 1 }}
          exit={{ opacity: 0 }}
          className="absolute inset-0 bg-gradient-to-br from-slate-900/95 via-gray-900/95 to-slate-900/95 backdrop-blur-xl z-50 flex items-center justify-center p-4"
        >
          <motion.div 
            initial={{ scale: 0.9, opacity: 0, y: 20 }}
            animate={{ scale: 1, opacity: 1, y: 0 }}
            exit={{ scale: 0.9, opacity: 0, y: 20 }}
            transition={{ type: "spring", stiffness: 300, damping: 30 }}
            className="bg-gradient-to-br from-slate-800/95 to-slate-900/95 rounded-2xl shadow-2xl max-w-md mx-4 overflow-hidden border border-gray-400/30"
          >
            {/* ãƒ˜ãƒƒãƒ€ãƒ¼ */}
            <div className="flex items-center justify-between p-6 border-b border-gray-400/20 bg-gradient-to-r from-gray-600/20 to-slate-600/20">
              <h2 className="text-white text-2xl font-bold bg-gradient-to-r from-gray-300 to-slate-300 bg-clip-text text-transparent">
                âš™ï¸ è¨­å®š
              </h2>
              <button
                onClick={() => setShowSettings(false)}
                className="w-10 h-10 rounded-full bg-gradient-to-br from-red-500/80 to-red-600/80 flex items-center justify-center text-white text-xl hover:from-red-400 hover:to-red-500 transition-all duration-200 shadow-lg"
              >
                Ã—
              </button>
            </div>
            
            {/* ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ */}
            <div className="p-6 text-white space-y-6">
              <motion.div 
                initial={{ opacity: 0, x: -20 }}
                animate={{ opacity: 1, x: 0 }}
                transition={{ delay: 0.1 }}
                className="bg-gradient-to-r from-blue-500/10 to-cyan-500/10 rounded-xl p-5 border border-blue-400/30 backdrop-blur-sm"
              >
                <div className="flex items-center justify-between">
                  <div>
                    <div className="font-bold text-lg mb-1 bg-gradient-to-r from-blue-400 to-cyan-400 bg-clip-text text-transparent">
                      ğŸ”Š ã‚µã‚¦ãƒ³ãƒ‰
                    </div>
                    <div className="text-sm text-gray-400">åŠ¹æœéŸ³ã®ã‚ªãƒ³/ã‚ªãƒ•</div>
                  </div>
                  <button
                    onClick={() => setSoundEnabled(!soundEnabled)}
                    className={`w-14 h-7 rounded-full transition-all duration-300 shadow-lg ${
                      soundEnabled 
                        ? 'bg-gradient-to-r from-green-500 to-emerald-500' 
                        : 'bg-gradient-to-r from-gray-600 to-slate-600'
                    }`}
                  >
                    <motion.div 
                      animate={{ x: soundEnabled ? 28 : 2 }}
                      transition={{ type: "spring", stiffness: 500, damping: 30 }}
                      className="w-6 h-6 bg-white rounded-full shadow-lg"
                    />
                  </button>
                </div>
              </motion.div>
              
              <motion.div 
                initial={{ opacity: 0, x: 20 }}
                animate={{ opacity: 1, x: 0 }}
                transition={{ delay: 0.2 }}
                className="bg-gradient-to-r from-purple-500/10 to-pink-500/10 rounded-xl p-5 border border-purple-400/30 backdrop-blur-sm"
              >
                <div className="flex items-center justify-between">
                  <div>
                    <div className="font-bold text-lg mb-1 bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text text-transparent">
                      ğŸ¤– ã‚ªãƒ¼ãƒˆãƒ—ãƒ¬ã‚¤
                    </div>
                    <div className="text-sm text-gray-400">AIè‡ªå‹•ãƒ—ãƒ¬ã‚¤ã®æœ‰åŠ¹åŒ–</div>
                  </div>
                  <button
                    onClick={() => setAutoPlayEnabled(!autoPlayEnabled)}
                    className={`w-14 h-7 rounded-full transition-all duration-300 shadow-lg ${
                      autoPlayEnabled 
                        ? 'bg-gradient-to-r from-green-500 to-emerald-500' 
                        : 'bg-gradient-to-r from-gray-600 to-slate-600'
                    }`}
                  >
                    <motion.div 
                      animate={{ x: autoPlayEnabled ? 28 : 2 }}
                      transition={{ type: "spring", stiffness: 500, damping: 30 }}
                      className="w-6 h-6 bg-white rounded-full shadow-lg"
                    />
                  </button>
                </div>
              </motion.div>

              <motion.div 
                initial={{ opacity: 0, y: 20 }}
                animate={{ opacity: 1, y: 0 }}
                transition={{ delay: 0.3 }}
                className="bg-gradient-to-r from-slate-700/50 to-slate-600/50 p-5 rounded-xl border border-slate-500/30 shadow-lg backdrop-blur-sm"
              >
                <div className="text-gray-300 text-lg font-bold mb-4 bg-gradient-to-r from-gray-300 to-slate-300 bg-clip-text text-transparent">
                  ãƒ†ãƒ¼ãƒ–ãƒ«è¨­å®š
                </div>
                <div className="space-y-3">
                  <div className="flex justify-between items-center">
                    <span className="text-gray-400 font-semibold">ãƒ–ãƒ©ã‚¤ãƒ³ãƒ‰:</span>
                    <span className="text-white font-bold text-lg bg-gradient-to-r from-yellow-400 to-orange-400 bg-clip-text text-transparent">
                      ${gameSettings.blinds.small}/${gameSettings.blinds.big}
                    </span>
                  </div>
                  <div className="flex justify-between items-center">
                    <span className="text-gray-400 font-semibold">æœ€å¤§ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼:</span>
                    <span className="text-white font-bold text-lg bg-gradient-to-r from-blue-400 to-cyan-400 bg-clip-text text-transparent">
                      {gameSettings.maxPlayers}
                    </span>
                  </div>
                  <div className="flex justify-between items-center">
                    <span className="text-gray-400 font-semibold">ãƒã‚¤ã‚¤ãƒ³:</span>
                    <span className="text-white font-bold text-lg bg-gradient-to-r from-green-400 to-emerald-400 bg-clip-text text-transparent">
                      ${gameSettings.buyIn}
                    </span>
                  </div>
                </div>
              </motion.div>
            </div>
          </motion.div>
        </motion.div>
      )}
    </div>
  );
}
